<!doctype html><html class="" data-reactroot=""><head><script async="" src="https://www.google-analytics.com/analytics.js"></script><script>
            window.GoogleAnalyticsObject="ga";(window.ga=window.ga||function(){(window.ga.q=window.ga.q||[]).push(arguments);}),(window.ga.l=1*new Date());

            ga('create', 'UA-169223577-1', 'auto');
            ga('send', 'pageview');</script><link rel="icon" type="image/png" href="/favicon.png"/>
<meta data-react-helmet="true" charset="utf-8"/><meta data-react-helmet="true" http-equiv="x-ua-compatible" content="ie=edge"/><meta data-react-helmet="true" name="description" content="循序渐进学 Deno &amp; 先易后难补 Node &amp; 面向未来的 Deno Web 应用开发。"/><meta data-react-helmet="true" name="viewport" content="width=device-width, initial-scale=1"/>
<title data-react-helmet="true">深入浅出 Create React App · Deno 钻研之术</title>
<link data-react-helmet="true" rel="stylesheet" href="/assets/index.css"/><link data-react-helmet="true" id="prismTheme" rel="stylesheet" href="/assets/prism.css"/>
<script data-react-helmet="true" >
    const shouldSetIsDark = document.cookie.includes('is_dark=1') ? true : document.cookie.includes('is_dark=0') ? false : window.matchMedia('(prefers-color-scheme: dark)').matches;
    if (shouldSetIsDark) {
      document.documentElement.classList.add('is_dark');
      document.getElementById('prismTheme').href = "/assets/prism_tomorrow.css";
    }
  </script>
</head><body><header><h1><a href="/">Deno 钻研之术</a></h1><nav><ul><li class="nav_custom_item"><a href="https://github.com/xcatliu/buy-me-a-coffee" target="_blank">打赏一下!!</a></li><li class="nav_custom_item"><a href="https://deno.land">官网</a></li><li class="nav_custom_item"><a href="https://github.com/hylerrix/awesome-deno-cn">资源</a></li><li class="nav_custom_item"><a href="https://nugine.github.io/deno-manual-cn">手册</a></li><li class="nav_custom_item"><a href="https://deno.js.cn">deno.js.cn</a></li><li class="nav_custom_item"><a href="https://denocn.org">denocn.org</a></li><li class="nav_custom_item"><a href="https://yoshixmk.github.io/deno-x-ranking/">Deno 库排行</a></li><li class="nav_custom_item"><a href="https://github.com/hylerrix">关于作者</a></li><li class="mobile_menu flex_center"><a class="czs-menu-l" href="#" style="background-image:url(&quot;/assets/czs-menu-l.svg&quot;)"></a></li><li class="mobile_header"><h1><a href="/">Deno 钻研之术</a></h1></li><li style="flex-grow:1"></li><li class="flex_center"><a class="czs-github-logo" href="https://github.com/hylerrix/deno-tutorial" target="_blank" style="background-image:url(&quot;/assets/czs-github-logo.svg&quot;)"></a></li><li class="toggle_dark flex_center"><span class="czs-sun" style="background-image:url(&quot;/assets/czs-sun.svg&quot;)"></span><span class="czs-sun-l" style="background-image:url(&quot;/assets/czs-sun-l.svg&quot;)"></span><span class="czs-moon" style="background-image:url(&quot;/assets/czs-moon.svg&quot;)"></span><span class="czs-moon-l" style="background-image:url(&quot;/assets/czs-moon-l.svg&quot;)"></span></li></ul></nav></header><aside class="sidebar"><ol><li class="unfold"><a href="/index.html" class="nav_link">Deno 钻研之术</a></li><li class="unfold"><a href="#" class="nav_link no_link">基础篇<span class="czs-angle-up-l" style="background-image:url(&quot;/assets/czs-angle-up-l.svg&quot;)"></span><span class="czs-angle-down-l" style="background-image:url(&quot;/assets/czs-angle-down-l.svg&quot;)"></span></a><ol style="height:auto"><li><a href="/articles/basic/install-and-hello-world.html" class="nav_link">Hello，从多样化安装到简单实战</a></li></ol></li><li class="unfold"><a href="#" class="nav_link no_link">生态篇<span class="czs-angle-up-l" style="background-image:url(&quot;/assets/czs-angle-up-l.svg&quot;)"></span><span class="czs-angle-down-l" style="background-image:url(&quot;/assets/czs-angle-down-l.svg&quot;)"></span></a><ol style="height:auto"><li><a href="/articles/ecology/awesome-deno-cn.html" class="nav_link">Awesome Deno 中文资源全图谱</a></li></ol></li><li class="unfold"><a href="#" class="nav_link no_link">Node 篇<span class="czs-angle-up-l" style="background-image:url(&quot;/assets/czs-angle-up-l.svg&quot;)"></span><span class="czs-angle-down-l" style="background-image:url(&quot;/assets/czs-angle-down-l.svg&quot;)"></span></a><ol style="height:auto"><li><a href="/articles/node/create-react-app-intro.html" class="nav_link active">深入浅出 Create React App</a></li><li><a href="/articles/node/javascript-toolchain-rome.html" class="nav_link">欲取代绝大多 JavaScript 工具链？Rome 尝鲜</a></li></ol></li><li class="unfold"><a href="#" class="nav_link no_link">翻译篇<span class="czs-angle-up-l" style="background-image:url(&quot;/assets/czs-angle-up-l.svg&quot;)"></span><span class="czs-angle-down-l" style="background-image:url(&quot;/assets/czs-angle-down-l.svg&quot;)"></span></a><ol style="height:auto"><li><a href="/translations/the-deno-handbook.html" class="nav_link">Deno 入门手册：附大量 TypeScript 代码实例</a></li><li><a href="/translations/deno-chat-app.html" class="nav_link">Deno + WebSockets 打造聊天室应用</a></li><li><a href="/translations/from-node-to-deno.html" class="nav_link">从 Node 到 Deno：探索各大主流库替代方案</a></li><li><a href="/translations/deno-oak-todo-api.html" class="nav_link">Deno + Oak 构建酷炫的 Todo API</a></li><li><a href="/translations/deno-oak-mysql.html" class="nav_link">Deno + Oak 连接 MySQL 实战教程</a></li></ol></li><li class="unfold"><a href="/articles/THANKS.html" class="nav_link">感谢</a></li></ol><hr/><a class="powered_by" href="https://github.com/xcatliu/pagic" target="_blank">Powered by <img src="/assets/pagic.png"/>agic</a></aside><section class="main"><div class="main_article"><article><h1>深入浅出 Create React App</h1>
<p>本文差点难产而死。因为总结的过程中，多次怀疑本文是对官方文档的直接翻译和简单罗列；同时官方文档很全面，全范围的介绍无疑加深了写作的心智负担。但在最终的梳理中，发现走出了一条与众不同的路，于是坚持分享出来。</p>
<p>希望本文除了能带领我们再次了解 Create React App(后文简称 CRA) 外，还能提供一种不同的知识组织结构和技术视角，加深我们对整个 React 技术生态的理解。</p>
<blockquote>
<p>本文可能是多篇博客的综合体，整理和写作时间 15h+，仔细阅读时间 30min+，请慢用。</p>
</blockquote>
<p>本文面向的读者是：</p>
<ul>
<li>前端开发初学者或 React 初学者；</li>
<li>使用过 CRA 搭建 React 项目但想拓展相关知识面的人；</li>
<li>希望通过一篇文章快速复习 CRA 的人；</li>
<li>英文初学者，想要通过一篇中文技术文章来让自己接下来读英文文档不再困难的人；</li>
<li>以及就想点进来支持一下的人。</li>
</ul>
<p>其次，本文在对官方文档进行一定的重新编排下，加上了如下创新点以完善整体的阅读学习体验：</p>
<ul>
<li>[x] 添加了实战 1：使用单个 HTML 文件构建 React App；</li>
<li>[x] 添加了实战 2：使用 Webpack 手动构建 React App；</li>
<li>[x] 添加了实战 3：使用 CRA 一站式构建 React App；</li>
<li>[x] 添加了实战 4：使用 Source Map Explorer 分析打包文件；</li>
<li>[x] 添加了实战 5：在已有的 React 项目中引入/升级 CRA；</li>
<li>[x] 添加了实战 6：使用 React App Rewired 注入新配置；</li>
<li>[x] 添加了：对 CRA 未来版本的简单展望；</li>
<li>[x] 添加了：一个 Dan 十年回顾文章的导读。</li>
</ul>
<p>最终，本文不涉及源码的解读，想要阅读源码的同学可以移步官方源码仓库，整体设计思路并不是很难，具体实现原理可以细细品嚼；且本文对与 CRA 不直接相关的技术点会略略而过，欢迎从点到面主动学习更多。以下是官方源码仓库以及官方文档地址：</p>
<ul>
<li>Github 地址：<a href="https://github.com/facebook/create-react-app">https://github.com/facebook/create-react-app</a></li>
<li>官方文档地址：<a href="https://create-react-app.dev/">https://create-react-app.dev</a></li>
</ul>
<p><img src="https://cdn.nlark.com/yuque/0/2020/png/86548/1578586685262-ca35e2db-94b8-4510-a922-8ef68ade06ee.png#align=left&amp;display=inline&amp;height=704&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=1408&amp;originWidth=2790&amp;size=145496&amp;status=done&amp;style=none&amp;width=1395" alt=""></p>
<h2 id="%E5%88%9D%E5%A7%8B%E5%8C%96-react-app-%E7%9A%84%E5%A4%9A%E7%A7%8D%E6%96%B9%E5%BC%8F">初始化 React App 的多种方式<a class="anchor" href="#%E5%88%9D%E5%A7%8B%E5%8C%96-react-app-%E7%9A%84%E5%A4%9A%E7%A7%8D%E6%96%B9%E5%BC%8F">§</a></h2>
<p>常见的初始化 React App 的方式有：</p>
<ul>
<li>不使用构建工具构建 React App；</li>
<li>使用 Webpack 手动构建 React App；</li>
<li>使用 Create React App 一站式构建 React App；</li>
<li>在在线沙箱平台直接构建 React App（一般用于 Demo 预演，本文不涉及）。</li>
</ul>
<p>下面我们分别进行介绍与实战练习。</p>
<h2 id="%E5%AE%9E%E6%88%98-1%EF%BC%9A%E4%BD%BF%E7%94%A8%E5%8D%95%E4%B8%AA-html-%E6%96%87%E4%BB%B6%E6%9E%84%E5%BB%BA-react-app">实战 1：使用单个 HTML 文件构建 React App<a class="anchor" href="#%E5%AE%9E%E6%88%98-1%EF%BC%9A%E4%BD%BF%E7%94%A8%E5%8D%95%E4%B8%AA-html-%E6%96%87%E4%BB%B6%E6%9E%84%E5%BB%BA-react-app">§</a></h2>
<p>React 本身专注于构建用户界面，并不依赖于某个构建工具，因此我们可以用传统的方式引入 React 并书写第一个“Hello World!” App。这种方式是快速尝试 React 的好方法，但并不适用于正式开发。</p>
<p>以下 HTML 代码段是一种实现方式，使用了可选的 Babel 编译和 JSX 语法，基于非构建工具的更多初始化页面的方法（如不使用 JSX 等）可以自行探索。</p>
<pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><a class="token url-link" href="https://unpkg.com/react@16/umd/react.development.js">https://unpkg.com/react@16/umd/react.development.js</a><span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><a class="token url-link" href="https://unpkg.com/react-dom@16/umd/react-dom.development.js">https://unpkg.com/react-dom@16/umd/react-dom.development.js</a><span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><a class="token url-link" href="https://unpkg.com/@babel/standalone/babel.min.js">https://unpkg.com/@babel/standalone/babel.min.js</a><span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span> <span class="token comment">&lt;!-- 不需要用于生产环境 --></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>root<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text/babel<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">
      <span class="token maybe-class-name">ReactDOM</span><span class="token punctuation">.</span><span class="token method function property-access">render</span><span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>h1<span class="token operator">></span><span class="token maybe-class-name">Hello</span><span class="token punctuation">,</span> world<span class="token operator">!</span><span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">></span><span class="token punctuation">,</span>
        <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span>
</code></pre>
<h2 id="%E5%AE%9E%E6%88%98-2%EF%BC%9A%E4%BD%BF%E7%94%A8-webpack-%E6%89%8B%E5%8A%A8%E6%9E%84%E5%BB%BA-react-app">实战 2：使用 Webpack 手动构建 React App<a class="anchor" href="#%E5%AE%9E%E6%88%98-2%EF%BC%9A%E4%BD%BF%E7%94%A8-webpack-%E6%89%8B%E5%8A%A8%E6%9E%84%E5%BB%BA-react-app">§</a></h2>
<p>构建工具有很多种，目前最为主流的构建工具当属 Webpack。如何使用 Webpack 逐步构建 React App？</p>
<blockquote>
<p>果不其然，为了证明 CRA 的便捷性而引出的本节 Webpack 实战，耗费了一小时多的时间进行了亲自踩坑，搜索了较多的博文都由于发布时间性而不能和最新的版本进行融合，最终根据 Github 中 <a href="https://github.com/ReactJSResources/react-webpack-babel">react-webpack-babel</a> 库的 package.json 文件里的相关信息才得到实现。</p>
</blockquote>
<pre class="language-bash"><code class="language-bash"><span class="token comment"># 创建一个项目并进入该项目</span>
$ <span class="token function">mkdir</span> react-webpack-steper <span class="token operator">&amp;</span> <span class="token builtin class-name">cd</span> react-webpack-steper
<span class="token comment"># 使用默认选项直接生成一个初始化的 package.json</span>
$ <span class="token function">npm</span> init -y
<span class="token comment"># 安装 React 基础包</span>
$ <span class="token function">sudo</span> <span class="token function">npm</span> <span class="token function">install</span> --save react react-dom
<span class="token comment"># 安装 Webpack 相关工具 - 打包、本地启动支持、本地异步请求模拟以及热更新等</span>
$ <span class="token function">sudo</span> <span class="token function">npm</span> <span class="token function">install</span> --save webpack webpack-cli webpack-dev-server
<span class="token comment"># 安装 Babel 相关工具 - 提供 ES6+ 新功能支持</span>
$ <span class="token function">sudo</span> <span class="token function">npm</span> <span class="token function">install</span> --save-dev @babel/cli @babel-core @babel/preset-env @babel/preset-react
$ <span class="token function">sudo</span> <span class="token function">npm</span> <span class="token function">install</span> --save-dev babel-loader babel-plugin-module-resolver html-webpack-plugin
<span class="token comment"># 新建打包、编译配置文件并准备编写</span>
$ <span class="token function">touch</span> webpack.config.js
$ <span class="token function">touch</span> .babelrc
<span class="token comment"># 新建 React 文件</span>
$ <span class="token function">mkdir</span> src
$ <span class="token function">touch</span> src/index.js
$ <span class="token function">touch</span> src/index.html
</code></pre>
<p>其中，webpack.config.js 源码如下：</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token maybe-class-name">HtmlWebpackPlugin</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'html-webpack-plugin'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span><span class="token property-access">exports</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  entry<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token method function property-access">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./src/index.js'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  module<span class="token operator">:</span> <span class="token punctuation">{</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex">/\.js$/</span><span class="token punctuation">,</span>
        exclude<span class="token operator">:</span> <span class="token regex">/node_modules/</span><span class="token punctuation">,</span>
        loader<span class="token operator">:</span> <span class="token string">'babel-loader'</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  resolve<span class="token operator">:</span> <span class="token punctuation">{</span>
    extensions<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'*'</span><span class="token punctuation">,</span> <span class="token string">'.js'</span><span class="token punctuation">,</span> <span class="token string">'.jsx'</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span>
    path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token method function property-access">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./build'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    filename<span class="token operator">:</span> <span class="token string">'bundle.js'</span><span class="token punctuation">,</span>
    publicPath<span class="token operator">:</span> <span class="token string">'/'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      template<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token method function property-access">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./src/index.html'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre>
<p>.babelrc 源码如下：</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token punctuation">{</span>
  <span class="token string">"presets"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"@babel/preset-env"</span><span class="token punctuation">,</span> <span class="token string">"@babel/preset-react"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token string">"plugins"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">[</span><span class="token string">"module-resolver"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token string">"root"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"./src"</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre>
<p>src/index.html 源码如下：</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token operator">&lt;</span><span class="token operator">!</span>doctype html<span class="token operator">></span>
<span class="token operator">&lt;</span>html lang<span class="token operator">=</span><span class="token string">"en"</span><span class="token operator">></span>
<span class="token operator">&lt;</span>head<span class="token operator">></span>
  <span class="token operator">&lt;</span>meta charset<span class="token operator">=</span><span class="token string">"utf-8"</span><span class="token operator">></span>
  <span class="token operator">&lt;</span>title<span class="token operator">></span><span class="token maybe-class-name">Hello</span> <span class="token maybe-class-name">World</span><span class="token operator">!</span><span class="token operator">&lt;</span><span class="token operator">/</span>title<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">></span>
<span class="token operator">&lt;</span>body<span class="token operator">></span>
  <span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">"root"</span><span class="token operator">></span><span class="token maybe-class-name">Loading</span><span class="token spread operator">...</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">></span>
</code></pre>
<p>src/index.js 源码如下：</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token keyword module">import</span> <span class="token maybe-class-name">React</span> <span class="token keyword module">from</span> <span class="token string">'react'</span>
<span class="token keyword module">import</span> <span class="token maybe-class-name">ReactDOM</span> <span class="token keyword module">from</span> <span class="token string">'react-dom'</span>

<span class="token maybe-class-name">ReactDOM</span><span class="token punctuation">.</span><span class="token method function property-access">render</span><span class="token punctuation">(</span>
  <span class="token operator">&lt;</span>h1<span class="token operator">></span><span class="token maybe-class-name">Hello</span><span class="token punctuation">,</span> world<span class="token operator">!</span><span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">></span><span class="token punctuation">,</span>
  <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
</code></pre>
<p>此时，一个基于 Webpack 手动搭建的简易型“Hello World”App 开发完成，可以通过如下命令本地运行。</p>
<pre class="language-bash"><code class="language-bash">$ webpack-dev-server --mode development --open --hot
</code></pre>
<p>更多自定义内容如添加 devServer 支持、添加多页应用支持...等各种各样新技术栈的支持，也可以引申实战。</p>
<h2 id="%E5%9B%A0%E6%AD%A4%EF%BC%8C%E6%88%91%E4%BB%AC%E9%9C%80%E8%A6%81-cra">因此，我们需要 CRA<a class="anchor" href="#%E5%9B%A0%E6%AD%A4%EF%BC%8C%E6%88%91%E4%BB%AC%E9%9C%80%E8%A6%81-cra">§</a></h2>
<p>可见，不使用构建工具编写不切实际，使用构建工具手动搭建 React App 又很繁琐。因此我们需要一个能初始化一个可直接运行项目的工具，并提供各种简易的插件，Create React App 应运而生。</p>
<blockquote>
<p>CRA 适用于中小型 React 项目。</p>
</blockquote>
<h3 id="cra-%E7%9A%84%E8%AE%BE%E8%AE%A1%E5%93%B2%E5%AD%A6">CRA 的设计哲学<a class="anchor" href="#cra-%E7%9A%84%E8%AE%BE%E8%AE%A1%E5%93%B2%E5%AD%A6">§</a></h3>
<ul>
<li>一种依赖关系。尽管 CRA 使用了 Webpack，Babel，ESLint 等各种出色的项目，但我们只需要 CRA 一种依赖；从 CRA 生成项目的 package.json 中也可以看到并没有 Webpack、Babel 的痕迹。</li>
<li>无需配置。我们无需进行任何额外配置便可以直接运行代码，专注业务开发；同时 CRA 还提供了开发和生产版本的合理配置。</li>
<li>非锁定配置。只需要运行一个命令， 所有的配置项和构建依赖项都将直接“弹出”到项目中，交由我们来修改。</li>
</ul>
<h3 id="cra-%E5%8C%85%E5%90%AB%E4%BA%86%E4%BB%80%E4%B9%88%EF%BC%9F">CRA 包含了什么？<a class="anchor" href="#cra-%E5%8C%85%E5%90%AB%E4%BA%86%E4%BB%80%E4%B9%88%EF%BC%9F">§</a></h3>
<p>CRA 将具有构建现代单页 React 应用所需的一切：</p>
<ul>
<li>React，JSX，ES6，TypeScript 和 Flow 语法支持；</li>
<li>ES6+ 标准的支持，例如对象传播运算符；</li>
<li>CSS 自动添加前缀的支持，因此我们不需要 -webkit- 或其他前缀；</li>
<li>快速的交互式单元测试运行程序，内置对覆盖率报告的支持；</li>
<li>实时开发服务器，警告常见错误；</li>
<li>一个构建脚本，用于将 JS，CSS 和图像与哈希和源映射捆绑在一起进行生产；</li>
<li>满足所有渐进式 Web 应用程序标准的 <a href="https://developers.google.com/web/fundamentals/getting-started/primers/service-workers">ServiceWorker</a> 和 <a href="https://developers.google.com/web/fundamentals/engage-and-retain/web-app-manifest/">Web 应用程序清单</a> 支持 （注意：从react-scripts@2.0.0及更高版本开始支持 ServiceWorker）；</li>
<li>单一依赖项即可轻松更新上述工具。</li>
</ul>
<h3 id="cra-%E7%9A%84%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF">CRA 的使用场景<a class="anchor" href="#cra-%E7%9A%84%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF">§</a></h3>
<p>Create React App 非常适合：</p>
<ul>
<li>在方便且功能丰富的开发环境中学习 React；</li>
<li>快速启动新的单页 React 应用程序；</li>
<li>快速使用 React 为库和组件创建示例。</li>
</ul>
<p>如果我们想在没有数百个传递构建工具依赖的情况下尝试 React，请考虑使用单个 HTML 文件构建或使用在线沙箱平台构建。</p>
<ul>
<li>如果需要将 React 代码与服务器端模板框架（如 Rails，Django 或 Symfony）集成，或者如果不构建单页应用，请考虑使用更灵活的 <a href="https://github.com/insin/nwb">nwb</a> 或 <a href="https://neutrino.js.org/">Neutrino</a>。特别是对于 Rails，可以使用 <a href="https://github.com/rails/webpacker">Rails Webpacker</a>。对于 Symfony，请尝试 <a href="https://symfony.com/doc/current/frontend/encore/reactjs.html">Symfony's Webpack Encore</a>；</li>
<li>如果需要发布 React 组件，<a href="https://github.com/insin/nwb">nwb</a> 以及 Neutrino 的 <a href="https://neutrino.js.org/packages/react-components/">react-components preset</a> 也可以这样做；</li>
<li>如果要使用 React 和 Node.js 进行服务器渲染，请查看 <a href="https://github.com/zeit/next.js/">Next.js</a> 或 <a href="https://github.com/jaredpalmer/razzle">Razzle</a>。 Create React App 与后端无关，仅生成静态HTML / JS / CSS包；</li>
<li>如果网站大部分是静态的（例如，投资组合或博客），请考虑改用 <a href="https://www.gatsbyjs.org/">Gatsby</a>。与 Create React App 不同，它在构建时会将网站预先渲染为 HTML；</li>
<li>最后，如果需要更多自定义设置，请查看 Neutrino 及其 <a href="https://neutrino.js.org/packages/react/">React preset</a>。</li>
</ul>
<h3 id="cra-%E6%94%AF%E6%8C%81%E7%9A%84%E6%B5%8F%E8%A7%88%E5%99%A8">CRA 支持的浏览器<a class="anchor" href="#cra-%E6%94%AF%E6%8C%81%E7%9A%84%E6%B5%8F%E8%A7%88%E5%99%A8">§</a></h3>
<p>一些支持的浏览器规则如下：</p>
<ul>
<li>默认情况下，生成的项目支持所有现代浏览器。 对 Internet Explorer 9、10 和 11 的支持需要 polyfill。 对于一组支持旧版浏览器的 polyfill，请使用 <a href="https://github.com/facebook/create-react-app/blob/master/packages/react-app-polyfill/README.md">react-app-polyfill</a>；</li>
<li>默认情况下，生成的项目在 package.json 文件中包含一个 browserslist 配置，以针对基于全球使用情况（&gt; 0.2％）的广泛浏览器（用于生产构建）和用于开发的现代浏览器。 这提供了良好的开发体验，尤其是在使用异步/等待等语言功能时，但仍与生产中的许多浏览器保持高度兼容性；</li>
<li>browserslist 配置控制输出的 JavaScript，以使注入的代码与指定的浏览器兼容。 通过运行构建脚本来创建生产构建时，将使用生产列表，而在运行启动脚本时，将使用开发列表。 可以使用 <a href="https://browserl.ist">https://browserl.ist</a> 查看配置的浏览器列表支持的浏览器；</li>
<li>请注意，这不会自动包括 polyfills，仍然需要根据所支持的浏览器来添加语言功能（见上文）；</li>
<li>在编辑 browserslist 配置时，我们的更改可能不会立即被获取。 这是由于 babel-loader 中的一个未检测到 package.json 中更改的问题。 一种快速的解决方案是删除 node_modules/.cache 文件夹，然后重试。</li>
</ul>
<p>这里的重点是 BrowsersList，一个“在不同的前端工具之间共用目标浏览器和 node 版本的配置工具”。简而言之，就是 Babel 等转移工具通过我们设置的 BrowsersList 中想要支持的浏览器版本来决定哪些语法需要被编译。</p>
<h3 id="cra-%E6%94%AF%E6%8C%81%E7%9A%84-es-%E6%A0%87%E5%87%86">CRA 支持的 ES 标准<a class="anchor" href="#cra-%E6%94%AF%E6%8C%81%E7%9A%84-es-%E6%A0%87%E5%87%86">§</a></h3>
<p>一些支持的 ES 标准规则如下：</p>
<ul>
<li>该项目支持最新 JavaScript 标准的超集。 除ES6语法功能外，它还支持：
<ul>
<li><a href="https://github.com/rwaldron/exponentiation-operator">Exponentiation Operator</a> (ES2016)；</li>
<li><a href="https://github.com/tc39/ecmascript-asyncawait">Async/await</a> (ES2017)；</li>
<li><a href="https://github.com/tc39/proposal-object-rest-spread">Object Rest/Spread Properties</a> (ES2018)；</li>
<li><a href="https://github.com/tc39/proposal-dynamic-import">Dynamic import()</a> (stage 4 proposal)；</li>
<li><a href="https://github.com/tc39/proposal-class-public-fields">Class Fields and Static Properties</a> (part of stage 3 proposal)；</li>
<li><a href="https://facebook.github.io/react/docs/introducing-jsx.html">JSX</a>, <a href="https://create-react-app.dev/docs/adding-flow">Flow</a> and <a href="https://create-react-app.dev/docs/adding-typescript">TypeScript</a>；</li>
<li>Learn more about <a href="https://tc39.github.io/process-document/">different proposal stages</a>。</li>
</ul>
</li>
<li>尽管 Facebook 建议谨慎使用实验性功能，但 Facebook 会在产品代码中大量使用这些功能，因此，如果将来任何这些建议发生更改，Facebook 都打算提供 <a href="https://medium.com/@cpojer/effective-javascript-codemods-5a6686bb46fb">codemod</a>；</li>
<li>请注意，默认情况下，该项目不包含任何 <a href="https://github.com/facebook/create-react-app/blob/master/packages/react-app-polyfill/README.md">polyfill</a>；</li>
<li>如果您使用任何其他需要运行时支持的ES6 +功能（例如Array.from（）或Symbol），请确保<a href="https://github.com/facebook/create-react-app/blob/master/packages/react-app-polyfill/README.md">手动包括适当的polyfill</a>，或者您要定位的浏览器已支持它们。</li>
</ul>
<h3 id="cra-%E7%9A%84%E4%B8%A4%E4%B8%AA%E6%A0%B8%E5%BF%83%E5%BA%93">CRA 的两个核心库<a class="anchor" href="#cra-%E7%9A%84%E4%B8%A4%E4%B8%AA%E6%A0%B8%E5%BF%83%E5%BA%93">§</a></h3>
<p>Create React App 有两个核心库，如下:</p>
<ul>
<li>create-react-app 是全局命令，用于创建初始化的 React 项目；</li>
<li>react-scripts 是所生成的项目中的开发依赖项，包括运行项目、测试项目、打包项目等多种命令。由于 CRA 的一种依赖性原则，react-scripts 便开放了所有内部其它依赖的使用方式。</li>
</ul>
<h2 id="%E5%AE%9E%E6%88%98-3%EF%BC%9A%E4%BD%BF%E7%94%A8-cra-%E6%9E%84%E5%BB%BA-react-app">实战 3：使用 CRA 构建 React App<a class="anchor" href="#%E5%AE%9E%E6%88%98-3%EF%BC%9A%E4%BD%BF%E7%94%A8-cra-%E6%9E%84%E5%BB%BA-react-app">§</a></h2>
<p>到这里，我们终于需要通过命令行来安装和使用 CRA，来构建我们的第三个“Hello World”App。</p>
<h3 id="%E5%85%A8%E5%B1%80%E5%AE%89%E8%A3%85-cra">全局安装 CRA<a class="anchor" href="#%E5%85%A8%E5%B1%80%E5%AE%89%E8%A3%85-cra">§</a></h3>
<p>为保证每一个新项目都能使用到 CRA 最新最全的功能，请确保 CRA 为最新版本。</p>
<pre class="language-bash"><code class="language-bash"><span class="token comment"># 在已安装 CRA 的情况下，可以先卸载 CRA</span>
$ <span class="token function">npm</span> uninstall -g create-react-app
<span class="token comment"># 正式安装 CRA</span>
$ <span class="token function">npm</span> <span class="token function">install</span> -g create-react-app
</code></pre>
<h3 id="%E5%88%9D%E5%A7%8B%E5%8C%96-cra-%E9%A1%B9%E7%9B%AE">初始化 CRA 项目<a class="anchor" href="#%E5%88%9D%E5%A7%8B%E5%8C%96-cra-%E9%A1%B9%E7%9B%AE">§</a></h3>
<p>根据我们的 npm 版本，选择相应命令来安装最新版的 CRA 并初始化第一个项目。同时检查自己的 node 版本，需要在本地开发计算机上安装 Node 8.16.0 或 Node 10.16.0 或更高版本（但服务器上不需要）。 我们可以使用nvm（macOS / Linux）或 nvm-windows 在不同项目之间切换Node版本。</p>
<pre class="language-bash"><code class="language-bash"><span class="token comment"># 查看自己的 npm 版本</span>
$ <span class="token function">npm</span> --version

<span class="token comment"># 第一种新建项目方式——npm 5.2+ 时，以下命令会安装最新版 CRA</span>
$ npx create-react-app my-app
<span class="token comment"># 第一种新建项目方式——npm 版本小于等于 5.1 时</span>
$ create-react-app my-app

<span class="token comment"># 第二种新建项目方式</span>
<span class="token comment"># npm 6+ 开始支持 npm init &lt;initializer> </span>
$ <span class="token function">npm</span> init react-app my-app

<span class="token comment"># 第三种新建项目方式</span>
$ <span class="token function">yarn</span> create react-app my-app
</code></pre>
<p><img src="https://cdn.nlark.com/yuque/0/2020/png/86548/1578397692108-1eba7684-3757-43c0-96a1-4705bd26ecaf.png#align=left&amp;display=inline&amp;height=298&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=595&amp;originWidth=825&amp;size=51054&amp;status=done&amp;style=none&amp;width=412.5" alt=""></p>
<h3 id="%E9%A1%B9%E7%9B%AE%E7%9A%84%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84">项目的文件结构<a class="anchor" href="#%E9%A1%B9%E7%9B%AE%E7%9A%84%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84">§</a></h3>
<p>通过命令行的构建，我们初始化了第一个 CRA 项目，其中帮我们生成的项目目录结构如下（只有 src 下的文件才会被 Webpack 处理，只有 public 下的文件才能被 public/index.html 使用）：</p>
<pre class="language-bash"><code class="language-bash">my-app
├── .git <span class="token comment"># 隐藏文件夹，会初始化第一个 Commit 记录</span>
├── README.md
├── node_modules
├── package.json <span class="token comment"># 依赖配置文件</span>
├── .gitignore
├── <span class="token punctuation">[</span>floder_name<span class="token punctuation">]</span> <span class="token comment"># 根目录下可以建立其他文件夹，但不会被用在生产环境中</span>
├── public <span class="token comment"># 只有 public 下的文件才能被 public/index.html 使用</span>
│   ├── favicon.ico
│   ├── index.html <span class="token comment"># public/index.html 页面模板</span>
│   └── manifest.json
└── src <span class="token comment"># 只有 src 下的文件才会被 Webpack 处理</span>
    ├── App.css
    ├── App.js
    ├── App.test.js
    ├── <span class="token punctuation">[</span>floder_name<span class="token punctuation">]</span> <span class="token comment"># 可以建立其他文件夹，以被 Webpack 成功导入</span>
    ├── index.css
    ├── index.js <span class="token comment"># JavaScript 打包入口文件</span>
    ├── logo.svg
    └── serviceWorker.js
</code></pre>
<p>关于 package.json、index.js 和 public/index.html 文件夹，我们通过“实战 2”已经有所了解。前者是 JavaScript 打包入口文件，通常链接整个业务代码；后者是页面模板，是打包后整个静态页面的总入口。</p>
<p>这里对以下两个文件的出现进行简要的意义概括。
_</p>
<ul>
<li>src/serviceWorker.js：提供渐进式 Web 应用的核心功能，不论网络状况如何都能立即加载，并且在不需要网络请求（离线时）的情况下也能展示 UI ；</li>
<li>public/manifest.json：是渐进式 Web 应用将自身添加至桌面的功能依赖文件，也可以对图标、名称等信息进行配置。</li>
</ul>
<h3 id="%E8%BF%90%E8%A1%8C-cra-%E9%A1%B9%E7%9B%AE">运行 CRA 项目<a class="anchor" href="#%E8%BF%90%E8%A1%8C-cra-%E9%A1%B9%E7%9B%AE">§</a></h3>
<p>CRA 默认提供了运行、测试、打包、部署以及弹出项目的命令。其中的一些贴士：</p>
<ul>
<li>npm start 内置热更新机制，代码改动时页面自动刷新；</li>
<li>npm test 以交互方式运行测试观察程序，默认情况下运行与自上次提交以来更改的文件相关的测试；</li>
<li>npm run build 将要生产的应用程序生成到生成文件夹。它在生产模式下正确捆绑了React，并优化了构建以获得最佳性能。生成文件被压缩，并且文件名包含哈希；</li>
<li>npm run eject 将内置的各种 Webpack 配置弹出到项目中，让我们可以进行自定义。同时此操作不可逆，意味着我们承担了弹出配置后的风险。通常不推荐弹出，可以通过 React App Rewired 库进行配置注入。</li>
</ul>
<pre class="language-bash"><code class="language-bash"><span class="token comment"># ---- 运行 ----</span>
$ <span class="token function">npm</span> start
$ <span class="token function">open</span> <a class="token url-link" href="http://localhost:3000">http://localhost:3000</a>
<span class="token comment"># ---- 测试 ----</span>
$ <span class="token function">npm</span> <span class="token builtin class-name">test</span>
<span class="token comment"># ---- 打包 ----</span>
$ <span class="token function">npm</span> run builds
<span class="token comment"># ---- 弹出配置 ----</span>
$ <span class="token function">npm</span> run <span class="token function">eject</span>
</code></pre>
<h3 id="%E6%90%AD%E5%BB%BA-cra-%E7%94%9F%E6%80%81">搭建 CRA 生态<a class="anchor" href="#%E6%90%AD%E5%BB%BA-cra-%E7%94%9F%E6%80%81">§</a></h3>
<p>根据官方文档的思路，我们还能从更多角度拓展 CRA 的使用边界，下面进行概要介绍。</p>
<ul>
<li>为开发环境添加额外功能：包括“配置编辑器风格”、“开发隔离组件”、“分析打包文件”和“添加 HTTPS 支持”；</li>
<li>添加样式与静态资源支持：包括“添加样式表文件”、“添加 CSS Modules 支持”、“添加 Sass 支持”、“添加 PostCSS 支持”、“添加图片文字和字体支持”、“添加 GraphQL 支持”、“使用 public 文件夹”、“进行代码拆分”；</li>
<li>添加业务驱动支持：包括安装各种依赖项如“BootStrap”、“Flow”、“TypeScript”、“Delay”、“Router”，以及“导出组件”、“使用全局变量”、“配置环境变量”、“制作渐进式 Web 应用”和“创建生产环境”；</li>
<li>添加测试支持：包括“运行测试”和“调试测试”；</li>
<li>添加后端集成支持：包括“在开发环境中代理 API 请求”、“使用 AJAX 请求获取数据”、“集成后端 API”和“使用 Title &amp; Meta 标签”；</li>
<li>部署进阶：包括“静态服务器”、“Azure”、“Firebase”、“Github Pages”等平台的部署等。</li>
</ul>
<p>这里无法深入展开，每一个点都可以是一个新的实战，当我们需要某个功能时便可以查阅相关文档来主动探索。其中“分析打包文件”的解读见“实战 4”。</p>
<h2 id="%E5%AE%9E%E6%88%98-4%EF%BC%9A%E4%BD%BF%E7%94%A8-source-map-explorer-%E5%88%86%E6%9E%90%E6%89%93%E5%8C%85%E6%96%87%E4%BB%B6">实战 4：使用 Source Map Explorer 分析打包文件<a class="anchor" href="#%E5%AE%9E%E6%88%98-4%EF%BC%9A%E4%BD%BF%E7%94%A8-source-map-explorer-%E5%88%86%E6%9E%90%E6%89%93%E5%8C%85%E6%96%87%E4%BB%B6">§</a></h2>
<pre class="language-bash"><code class="language-bash"><span class="token comment"># 安装文件分析工具 source-map-explorer</span>
$ <span class="token function">sudo</span> <span class="token function">npm</span> <span class="token function">install</span> --save source-map-explorer
<span class="token comment"># 打包项目</span>
$ <span class="token function">npm</span> run build
<span class="token comment"># 将如下命令放入 package.json 中并生成快捷方式 npm run analyze</span>
<span class="token comment"># $ source-map-explorer 'build/static/js/*.js'</span>
<span class="token comment"># 注意此命令直接在命令行输入会提示找不到相关命令</span>
$ <span class="token function">npm</span> run analyze
</code></pre>
<p>对于一个刚被 CRA 生成的 React App 来说，分析的结果如下，包大小总计 129.38k。</p>
<p><img src="https://cdn.nlark.com/yuque/0/2020/png/86548/1578588582058-7e1849b9-420a-4ef1-87ce-f032359d3826.png#align=left&amp;display=inline&amp;height=443&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=886&amp;originWidth=1502&amp;size=59266&amp;status=done&amp;style=none&amp;width=751" alt=""></p>
<h2 id="%E5%AE%9E%E6%88%98-5%EF%BC%9A%E5%9C%A8%E5%B7%B2%E6%9C%89%E7%9A%84-react-%E9%A1%B9%E7%9B%AE%E4%B8%AD%E5%BC%95%E5%85%A5%2F%E5%8D%87%E7%BA%A7-cra">实战 5：在已有的 React 项目中引入/升级 CRA<a class="anchor" href="#%E5%AE%9E%E6%88%98-5%EF%BC%9A%E5%9C%A8%E5%B7%B2%E6%9C%89%E7%9A%84-react-%E9%A1%B9%E7%9B%AE%E4%B8%AD%E5%BC%95%E5%85%A5%2F%E5%8D%87%E7%BA%A7-cra">§</a></h2>
<p>回到刚才“实战 2”建立的 react-webpack-steper 项目中，当我们已经编写了一部分业务时，能否直接在当前项目中无痛引入 CRA？</p>
<p>解决思路便是：在大多数情况下，更改 package.json 中的 react-scripts 版本并删除不必要依赖配置，接着在此文件夹中运行 npm install 就足够了，但最好参考更改日志以了解潜在的重大更改。CRA 致力于将重大更改保持在最低限度，以便可以轻松升级 React 脚本。</p>
<pre class="language-bash"><code class="language-bash"><span class="token comment"># 卸载 CRA 本身已经提供的依赖</span>
$ <span class="token function">sudo</span> <span class="token function">npm</span> uninstall --save webpack webpack-cli webpack-dev-server
$ <span class="token function">sudo</span> <span class="token function">npm</span> uninstall --save-dev @babel/cli @babel-core @babel/preset-env @babel/preset-react
$ <span class="token function">sudo</span> <span class="token function">npm</span> uninstall --save-dev babel-loader babel-plugin-module-resolver html-webpack-plugin
<span class="token comment"># 删除 CRA 不需要使用的文件</span>
$ <span class="token function">rm</span> webpack.config.js .babelrc
<span class="token comment"># 删除 node_modules</span>
$ <span class="token function">rm</span> -rf node_modules
<span class="token comment"># 手动安装 React Script</span>
$ <span class="token function">sudo</span> <span class="token function">npm</span> <span class="token function">install</span> --save <a class="token email-link" href="mailto:react-scripts@latest">react-scripts@latest</a>
<span class="token comment"># 由于 CRA 默认规则，将 src/index.html 移至 public/index.html</span>
$ <span class="token function">mkdir</span> public
$ <span class="token function">mv</span> src/index.html public
<span class="token comment"># 在 package.json 中添加 React Script 启动命令</span>
$ <span class="token function">vim</span> package.json
</code></pre>
<p>package.json 中添加/覆盖如下指令。</p>
<pre class="language-bash"><code class="language-bash"><span class="token string">"scripts"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">"start"</span><span class="token builtin class-name">:</span> <span class="token string">"react-scripts start"</span>,
    <span class="token string">"build"</span><span class="token builtin class-name">:</span> <span class="token string">"react-scripts build"</span>,
    <span class="token string">"test"</span><span class="token builtin class-name">:</span> <span class="token string">"react-scripts test"</span>,
    <span class="token string">"eject"</span><span class="token builtin class-name">:</span> <span class="token string">"react-scripts eject"</span>,
</code></pre>
<p>再次执行即可。由于每个人的具体配置不一定一致，可根据自身所遇问题进行搜索。升级原理类似。</p>
<pre class="language-bash"><code class="language-bash"><span class="token comment"># 当没有 BrowsersList 时，CRA 会进行询问并帮助我们生成</span>
$ <span class="token function">npm</span> start
</code></pre>
<h2 id="%E5%AE%9E%E6%88%98-6%EF%BC%9A%E4%BD%BF%E7%94%A8-react-app-rewired-%E6%B3%A8%E5%85%A5%E6%96%B0%E9%85%8D%E7%BD%AE">实战 6：使用 React App Rewired 注入新配置<a class="anchor" href="#%E5%AE%9E%E6%88%98-6%EF%BC%9A%E4%BD%BF%E7%94%A8-react-app-rewired-%E6%B3%A8%E5%85%A5%E6%96%B0%E9%85%8D%E7%BD%AE">§</a></h2>
<p>CRA 官方并不推荐使用 npm run eject 弹出配置，这会增加更多的 Webpack 维护工作。对于实在想改的 Webpack 配置来说，我们可以使用 <a href="https://github.com/timarney/react-app-rewired">React App Rewired</a> 库进行配置注入，这里来做个小例子。</p>
<blockquote>
<p>此工具可以在不 'eject' 也不创建额外 react-scripts 的情况下修改 create-react-app 内置的 webpack 配置，然后你将拥有 create-react-app 的一切特性，且可以根据你的需要去配置 webpack 的 plugins, loaders 等。</p>
</blockquote>
<p>继续使用 react-webpack-steper 项目，我们的简易目标是增加 devServer 本地代理。</p>
<p><strong>第一步：安装依赖并进行基础配置</strong></p>
<pre class="language-bash"><code class="language-bash"><span class="token comment"># 安装依赖</span>
$ <span class="token function">sudo</span> <span class="token function">npm</span> <span class="token function">install</span> --save-dev react-app-rewired customize-cra
<span class="token comment"># 根目录建立 config-overrides.js</span>
$ <span class="token function">touch</span> config-overrides.js
<span class="token comment"># 修改 package.json</span>
$ <span class="token function">vim</span> package.json
<span class="token comment"># 运行项目</span>
$ <span class="token function">npm</span> start
</code></pre>
<p>其中，config-overrides.js 的初始代码为：</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token comment">/* config-overrides.js */</span>
module<span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">override</span><span class="token punctuation">(</span><span class="token parameter">config<span class="token punctuation">,</span> env</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//do stuff with the webpack config...</span>
  <span class="token keyword">return</span> config<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>package.json 的修改思路为：</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token comment">/* package.json */</span>
<span class="token string">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
<span class="token operator">-</span> <span class="token string">"start"</span><span class="token operator">:</span> <span class="token string">"react-scripts start"</span><span class="token punctuation">,</span>
<span class="token operator">+</span> <span class="token string">"start"</span><span class="token operator">:</span> <span class="token string">"react-app-rewired start"</span><span class="token punctuation">,</span>
<span class="token operator">-</span> <span class="token string">"build"</span><span class="token operator">:</span> <span class="token string">"react-scripts build"</span><span class="token punctuation">,</span>
<span class="token operator">+</span> <span class="token string">"build"</span><span class="token operator">:</span> <span class="token string">"react-app-rewired build"</span><span class="token punctuation">,</span>
<span class="token operator">-</span> <span class="token string">"test"</span><span class="token operator">:</span> <span class="token string">"react-scripts test --env=jsdom"</span><span class="token punctuation">,</span>
<span class="token operator">+</span> <span class="token string">"test"</span><span class="token operator">:</span> <span class="token string">"react-app-rewired test --env=jsdom"</span><span class="token punctuation">,</span>
  <span class="token string">"eject"</span><span class="token operator">:</span> <span class="token string">"react-scripts eject"</span>
<span class="token punctuation">}</span>
</code></pre>
<p><strong>第二步：编写配置，进行代理</strong></p>
<pre class="language-bash"><code class="language-bash"><span class="token comment"># 新增配置文件</span>
$ <span class="token function">mkdir</span> config
$ <span class="token function">touch</span> config/proxy.js
<span class="token comment"># 修改 config-overrides.js</span>
$ <span class="token function">vim</span> config-overrides.js
</code></pre>
<p>其中，config/proxy.js 源码是：</p>
<pre class="language-javascript"><code class="language-javascript">module<span class="token punctuation">.</span><span class="token property-access">exports</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token string">'/api/**'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      target<span class="token operator">:</span> <span class="token string">'<a class="token url-link" href="http://110.114.120.120:8080">http://110.114.120.120:8080</a>'</span><span class="token punctuation">,</span>
      secure<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      changeOrigin<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre>
<p>config-overrides.js 修改为：</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token punctuation">{</span> overrideDevServer <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'customize-cra'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> proxy <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./config/proxy'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span><span class="token property-access">exports</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  devServer<span class="token operator">:</span> <span class="token function">overrideDevServer</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">config</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      config<span class="token punctuation">.</span><span class="token property-access">proxy</span> <span class="token operator">=</span> proxy
      <span class="token keyword">return</span> config
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre>
<p>此时，本地的所有 api 开头的接口请求都会被转发到 <a href="http://110.114.120.120:8080">http://110.114.120.120:8080</a> 的模拟后端 IP 上。</p>
<h2 id="%E5%AF%B9-cra-%E6%9C%AA%E6%9D%A5%E7%89%88%E6%9C%AC%E7%9A%84%E7%AE%80%E5%8D%95%E5%B1%95%E6%9C%9B">对 CRA 未来版本的简单展望<a class="anchor" href="#%E5%AF%B9-cra-%E6%9C%AA%E6%9D%A5%E7%89%88%E6%9C%AC%E7%9A%84%E7%AE%80%E5%8D%95%E5%B1%95%E6%9C%9B">§</a></h2>
<p>截止目前(2020-01-10)，CRA 的最新版本是 v3.3.0，我们可以从 Github 的 MileStone 中看到未来可能会改善的功能，其中整理并如下所述。</p>
<ul>
<li>v3.x：添加多入口文件支持（不只是一个 index.js 入口）；使用 worker-loader 添加对 WebWorker 的支持；更早地检查 Node 的版本；添加对子资源完整性 SRI 支持；生产环境中预加载脚本和链接...</li>
<li>v4.0：支持 Webpack 5.0（Webpack 目前最新版 v4.41.5，v5 也推出了一年多内测版）；在 tsconfig.json 和 jsconfig.json 里新增对 baseUrl 和 paths 的支持（方便写 @ 绝对路径等）；支持 Jest 配置中设置browser 为 true（根据环境提供正确的 Node 或 Browser 模块）...</li>
<li>v100.0：提供构建过程中的监视模式；适用于 Hooks 的热加载...</li>
</ul>
<p>让我们一起持续关注。</p>
<h2 id="%E7%BB%93%E8%AF%AD">结语<a class="anchor" href="#%E7%BB%93%E8%AF%AD">§</a></h2>
<p>回顾文章，我们从初始化 React App 的多种方式，引出 CRA 的必要性再对其进行较为充分的解释，最后配上 6 个角度来从一些角度对 CRA 的使用方式进行了实战，最后回归到 CRA 的版本展望之中。</p>
<p>感谢你的阅读，如果你有什么更多的疑惑，CRA 的官方文档 + 开源仓库一定会满足你的一切。</p>
<p><img src="https://cdn.nlark.com/yuque/0/2020/png/86548/1578591055691-2065e9cb-0776-4c28-85e4-7eab17645dbe.png#align=left&amp;display=inline&amp;height=284&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=860&amp;originWidth=796&amp;size=425153&amp;status=done&amp;style=none&amp;width=263" alt=""></p>
<p>最后，一起拜读一下 CRA 和 Redux 作者、React 的核心贡献者 Dan Abramov 发布的这篇“<a href="https://overreacted.io/my-decade-in-review/">我的十年回顾</a>”文章。</p>
<p>现在我们可以开始正式深入地学习 React 技术栈了。</p>
</article></div><div class="main_toc_container nav_link_container"><div class="main_toc"><aside><nav class="toc"><ol><li><a href="#%E5%88%9D%E5%A7%8B%E5%8C%96-react-app-%E7%9A%84%E5%A4%9A%E7%A7%8D%E6%96%B9%E5%BC%8F">初始化 React App 的多种方式</a></li><li><a href="#%E5%AE%9E%E6%88%98-1%EF%BC%9A%E4%BD%BF%E7%94%A8%E5%8D%95%E4%B8%AA-html-%E6%96%87%E4%BB%B6%E6%9E%84%E5%BB%BA-react-app">实战 1：使用单个 HTML 文件构建 React App</a></li><li><a href="#%E5%AE%9E%E6%88%98-2%EF%BC%9A%E4%BD%BF%E7%94%A8-webpack-%E6%89%8B%E5%8A%A8%E6%9E%84%E5%BB%BA-react-app">实战 2：使用 Webpack 手动构建 React App</a></li><li><a href="#%E5%9B%A0%E6%AD%A4%EF%BC%8C%E6%88%91%E4%BB%AC%E9%9C%80%E8%A6%81-cra">因此，我们需要 CRA</a><ol><li><a href="#cra-%E7%9A%84%E8%AE%BE%E8%AE%A1%E5%93%B2%E5%AD%A6">CRA 的设计哲学</a></li><li><a href="#cra-%E5%8C%85%E5%90%AB%E4%BA%86%E4%BB%80%E4%B9%88%EF%BC%9F">CRA 包含了什么？</a></li><li><a href="#cra-%E7%9A%84%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF">CRA 的使用场景</a></li><li><a href="#cra-%E6%94%AF%E6%8C%81%E7%9A%84%E6%B5%8F%E8%A7%88%E5%99%A8">CRA 支持的浏览器</a></li><li><a href="#cra-%E6%94%AF%E6%8C%81%E7%9A%84-es-%E6%A0%87%E5%87%86">CRA 支持的 ES 标准</a></li><li><a href="#cra-%E7%9A%84%E4%B8%A4%E4%B8%AA%E6%A0%B8%E5%BF%83%E5%BA%93">CRA 的两个核心库</a></li></ol></li><li><a href="#%E5%AE%9E%E6%88%98-3%EF%BC%9A%E4%BD%BF%E7%94%A8-cra-%E6%9E%84%E5%BB%BA-react-app">实战 3：使用 CRA 构建 React App</a><ol><li><a href="#%E5%85%A8%E5%B1%80%E5%AE%89%E8%A3%85-cra">全局安装 CRA</a></li><li><a href="#%E5%88%9D%E5%A7%8B%E5%8C%96-cra-%E9%A1%B9%E7%9B%AE">初始化 CRA 项目</a></li><li><a href="#%E9%A1%B9%E7%9B%AE%E7%9A%84%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84">项目的文件结构</a></li><li><a href="#%E8%BF%90%E8%A1%8C-cra-%E9%A1%B9%E7%9B%AE">运行 CRA 项目</a></li><li><a href="#%E6%90%AD%E5%BB%BA-cra-%E7%94%9F%E6%80%81">搭建 CRA 生态</a></li></ol></li><li><a href="#%E5%AE%9E%E6%88%98-4%EF%BC%9A%E4%BD%BF%E7%94%A8-source-map-explorer-%E5%88%86%E6%9E%90%E6%89%93%E5%8C%85%E6%96%87%E4%BB%B6">实战 4：使用 Source Map Explorer 分析打包文件</a></li><li><a href="#%E5%AE%9E%E6%88%98-5%EF%BC%9A%E5%9C%A8%E5%B7%B2%E6%9C%89%E7%9A%84-react-%E9%A1%B9%E7%9B%AE%E4%B8%AD%E5%BC%95%E5%85%A5%2F%E5%8D%87%E7%BA%A7-cra">实战 5：在已有的 React 项目中引入/升级 CRA</a></li><li><a href="#%E5%AE%9E%E6%88%98-6%EF%BC%9A%E4%BD%BF%E7%94%A8-react-app-rewired-%E6%B3%A8%E5%85%A5%E6%96%B0%E9%85%8D%E7%BD%AE">实战 6：使用 React App Rewired 注入新配置</a></li><li><a href="#%E5%AF%B9-cra-%E6%9C%AA%E6%9D%A5%E7%89%88%E6%9C%AC%E7%9A%84%E7%AE%80%E5%8D%95%E5%B1%95%E6%9C%9B">对 CRA 未来版本的简单展望</a></li><li><a href="#%E7%BB%93%E8%AF%AD">结语</a></li></ol></nav></aside></div></div></section><div class="tools flex_center"><a class="czs-pen button" href="https://github.com/hylerrix/deno-tutorial/edit/master/articles/node/create-react-app-intro.md" target="_blank" style="background-image:url(&quot;/assets/czs-pen.svg&quot;)"></a><a class="czs-angle-up-l button" href="#" style="background-image:url(&quot;/assets/czs-angle-up-l.svg&quot;)"></a></div><script crossorigin="anonymous" src="https://unpkg.com/react@16.13.1/umd/react.production.min.js"></script><script crossorigin="anonymous" src="https://unpkg.com/react-dom@16.13.1/umd/react-dom.production.min.js"></script><script type="module" src="/index.js"></script></body></html>