<!doctype html><html class="" data-reactroot=""><head><script async="" src="https://www.google-analytics.com/analytics.js"></script><script>
            window.GoogleAnalyticsObject="ga";(window.ga=window.ga||function(){(window.ga.q=window.ga.q||[]).push(arguments);}),(window.ga.l=1*new Date());

            ga('create', 'UA-169223577-1', 'auto');
            ga('send', 'pageview');</script><link rel="icon" type="image/png" href="/favicon.png"/>
<meta data-react-helmet="true" charset="utf-8"/><meta data-react-helmet="true" http-equiv="x-ua-compatible" content="ie=edge"/><meta data-react-helmet="true" name="description" content="循序渐进学 Deno &amp; 先易后难补 Node &amp; 面向未来的 Deno Web 应用开发。"/><meta data-react-helmet="true" name="viewport" content="width=device-width, initial-scale=1"/>
<title data-react-helmet="true">How to Use MySQL With Deno and Oak · Deno 钻研之术</title>
<link data-react-helmet="true" rel="stylesheet" href="/assets/index.css"/><link data-react-helmet="true" id="prismTheme" rel="stylesheet" href="/assets/prism.css"/>
<script data-react-helmet="true" >
    const shouldSetIsDark = document.cookie.includes('is_dark=1') ? true : document.cookie.includes('is_dark=0') ? false : window.matchMedia('(prefers-color-scheme: dark)').matches;
    if (shouldSetIsDark) {
      document.documentElement.classList.add('is_dark');
      document.getElementById('prismTheme').href = "/assets/prism_tomorrow.css";
    }
  </script>
</head><body><header><h1 class="hide_on_mobile"><a href="/">Deno 钻研之术</a></h1><nav><ul><li class="show_on_mobile flex_center"><a class="czs-menu-l" href="#" style="background-image:url(&quot;/assets/czs-menu-l.svg&quot;)"></a></li><li class="show_on_mobile"><h1 class="mobile_title"><a href="/">Deno 钻研之术</a></h1></li><li class="hide_on_mobile"><a href="/articles/">文章</a></li><li class="hide_on_mobile"><a href="http://qiniu.ningo.cloud/hylerrix/reward-alipay.png" target="_blank">打赏一下!!</a></li><li class="hide_on_mobile"><a href="https://github.com/hylerrix/awesome-deno-cn" target="_blank">资源</a></li><li class="hide_on_mobile"><a href="http://tutorial.deno.js.cn" target="_blank">镜像</a></li><li class="hide_on_mobile"><a href="https://github.com/hylerrix/deno-feedly" target="_blank">Deno 双周刊</a></li><li class="hide_on_mobile"><a href="https://github.com/hylerrix" target="_blank">持续添加中...</a></li><li class="hide_on_mobile"><a href="https://github.com/ningowood" target="_blank">凝果屋</a></li><li class="hide_on_mobile"><a href="https://github.com/hylerrix" target="_blank">关于</a></li><li style="flex-grow:1"></li><li class="flex_center"><a class="czs-github-logo" href="https://github.com/hylerrix/deno-tutorial" target="_blank" style="background-image:url(&quot;/assets/czs-github-logo.svg&quot;)"></a></li><li class="toggle_dark flex_center"><span class="czs-sun" style="background-image:url(&quot;/assets/czs-sun.svg&quot;)"></span><span class="czs-sun-l" style="background-image:url(&quot;/assets/czs-sun-l.svg&quot;)"></span><span class="czs-moon" style="background-image:url(&quot;/assets/czs-moon.svg&quot;)"></span><span class="czs-moon-l" style="background-image:url(&quot;/assets/czs-moon-l.svg&quot;)"></span></li></ul></nav></header><aside class="sidebar"><ol class="list_style_none"><li class=""><a href="/articles/index.html" class="nav_link">Deno 钻研之术</a></li><li class="unfold"><a href="/articles/document/index.html" class="nav_link">文档篇<span class="czs-angle-up-l" style="background-image:url(&quot;/assets/czs-angle-up-l.svg&quot;)"></span><span class="czs-angle-down-l" style="background-image:url(&quot;/assets/czs-angle-down-l.svg&quot;)"></span></a><ol class="list_style_none"><li class=""><a href="/articles/document/deno-version-handbook.html" class="nav_link">Deno 版本历史概览</a></li><li class=""><a href="/articles/document/deno-cli-handbook.html" class="nav_link">Deno CLI 通用手册</a></li><li class=""><a href="/articles/document/deno-translation-dictionary.html" class="nav_link">Deno 专业术语翻译手册</a></li></ol></li><li class="unfold"><a href="/articles/basic/index.html" class="nav_link">基础篇<span class="czs-angle-up-l" style="background-image:url(&quot;/assets/czs-angle-up-l.svg&quot;)"></span><span class="czs-angle-down-l" style="background-image:url(&quot;/assets/czs-angle-down-l.svg&quot;)"></span></a><ol class="list_style_none"><li class=""><a href="/articles/basic/install-and-hello-world.html" class="nav_link">Hello，从多样化安装到简单实战</a></li></ol></li><li class="unfold"><a href="/articles/architecture/index.html" class="nav_link">架构篇<span class="czs-angle-up-l" style="background-image:url(&quot;/assets/czs-angle-up-l.svg&quot;)"></span><span class="czs-angle-down-l" style="background-image:url(&quot;/assets/czs-angle-down-l.svg&quot;)"></span></a><ol class="list_style_none"><li class="unfold"><a href="/articles/architecture/cli/index.html" class="nav_link">CLI 篇<span class="czs-angle-up-l" style="background-image:url(&quot;/assets/czs-angle-up-l.svg&quot;)"></span><span class="czs-angle-down-l" style="background-image:url(&quot;/assets/czs-angle-down-l.svg&quot;)"></span></a><ol class="list_style_none"><li class=""><a href="/articles/architecture/cli/deno-cli-v1-function.html" class="nav_link">从 CLI 指令通读 Deno v1.x 全特性</a></li></ol></li></ol></li><li class="unfold"><a href="/articles/ecology/index.html" class="nav_link">生态篇<span class="czs-angle-up-l" style="background-image:url(&quot;/assets/czs-angle-up-l.svg&quot;)"></span><span class="czs-angle-down-l" style="background-image:url(&quot;/assets/czs-angle-down-l.svg&quot;)"></span></a><ol class="list_style_none"><li class=""><a href="/articles/ecology/awesome-deno-cn.html" class="nav_link">Awesome Deno 中文资源全图谱</a></li></ol></li><li class="unfold"><a href="/articles/node/index.html" class="nav_link">Node 篇<span class="czs-angle-up-l" style="background-image:url(&quot;/assets/czs-angle-up-l.svg&quot;)"></span><span class="czs-angle-down-l" style="background-image:url(&quot;/assets/czs-angle-down-l.svg&quot;)"></span></a><ol class="list_style_none"><li class=""><a href="/articles/node/create-react-app-intro.html" class="nav_link">深入浅出 Create React App</a></li><li class=""><a href="/articles/node/javascript-toolchain-rome.html" class="nav_link">欲取代绝大多 JavaScript 工具链？Rome 尝鲜</a></li></ol></li><li class="unfold"><a href="/articles/official/index.html" class="nav_link">官方篇<span class="czs-angle-up-l" style="background-image:url(&quot;/assets/czs-angle-up-l.svg&quot;)"></span><span class="czs-angle-down-l" style="background-image:url(&quot;/assets/czs-angle-down-l.svg&quot;)"></span></a><ol class="list_style_none"><li class=""><a href="/articles/official/thoroughgoing-deno-in-2020.html" class="nav_link">精读《Deno 2020 官方回顾及 2021 展望》</a></li></ol></li><li class="unfold"><a href="/articles/translation/index.html" class="nav_link">翻译篇<span class="czs-angle-up-l" style="background-image:url(&quot;/assets/czs-angle-up-l.svg&quot;)"></span><span class="czs-angle-down-l" style="background-image:url(&quot;/assets/czs-angle-down-l.svg&quot;)"></span></a><ol class="list_style_none"><li class=""><a href="/articles/translation/the-deno-handbook.html" class="nav_link">Deno 入门手册：附大量 TypeScript 代码实例</a></li><li class=""><a href="/articles/translation/deno-chat-app.html" class="nav_link">Deno + WebSockets 打造聊天室应用</a></li><li class=""><a href="/articles/translation/from-node-to-deno.html" class="nav_link">从 Node 到 Deno：探索各大主流库替代方案</a></li><li class=""><a href="/articles/translation/deno-oak-todo-api.html" class="nav_link">Deno + Oak 构建酷炫的 Todo API</a></li><li class=""><a href="/articles/translation/deno-oak-mysql.html" class="nav_link">Deno + Oak 连接 MySQL 实战教程</a></li><li class=""><a href="/articles/translation/why-deno-wrong.html" class="nav_link">为什么我认为 Deno 是一个迈向错误方向的 JavaScript 运行时？</a></li></ol></li><li class=""><a href="/articles/THANKS.html" class="nav_link">感谢</a></li></ol></aside><section class="main"><div class="main_article"><article><h1>How to Use MySQL With Deno and Oak</h1>
<p><img src="https://images.unsplash.com/photo-1591509867461-d9f58becc082?ixlib=rb-1.2.1&amp;q=80&amp;fm=jpg&amp;crop=entropy&amp;cs=tinysrgb&amp;w=2000&amp;fit=max&amp;ixid=eyJhcHBfaWQiOjExNzczfQ" alt="How to Use MySQL With Deno and Oak"></p>
<p>I recently wrote about how to make a  <strong><a href="https://www.freecodecamp.org/news/create-a-todo-api-in-deno-written-by-a-guy-coming-from-node/">Todo API in Deno + Oak (without using a database)</a></strong>. You can find the repo under  <strong><a href="https://github.com/adeelibr/deno-playground/tree/master/chapter_1:oak">chapter_1:oak</a></strong> on GitHub.</p>
<p>This tutorial picks up where the other left off, and I'll go over how to integrate MySQL into a Deno and Oak project.</p>
<p>If at any time you want to see the entire source code used in this tutorial, it's available at  <a href="https://github.com/adeelibr/deno-playground/tree/master/chapter_2:mysql"><strong>chapter_2:mysql</strong></a>. Feel free to give it a star on GitHub if you like it.</p>
<p>I'm assuming that you already completed the last tutorial mentioned above. If not, check it out  <a href="https://www.freecodecamp.org/news/create-a-todo-api-in-deno-written-by-a-guy-coming-from-node/">here</a>  and come back when you're finished.</p>
<p>Before we start, make sure that you have a MySQL client installed and running:</p>
<ul>
<li>MySQL community server [<a href="https://dev.mysql.com/downloads/mysql/">Download here</a>]</li>
<li>MySQL Workbench [<a href="https://dev.mysql.com/downloads/workbench/">Download here</a>]</li>
</ul>
<p>I wrote a small guide for Mac OS users on setting up MySQL because I struggled with it as well. Check it out  <a href="https://github.com/adeelibr/deno-playground/blob/master/guidelines/setting-up-mysql-mac-os-catalina.md">here</a>.</p>
<p>If you are on a Windows machine you can use the same tools or you can also use  <a href="https://www.apachefriends.org/index.html">XAMPP</a>  to have a MySQL instance running in your dashboard.</p>
<p>Once you have a MySQL instance running we can begin our tutorial.</p>
<h2 id="lets-begin">Let's Begin<a class="anchor" href="#lets-begin">§</a></h2>
<p>Assuming that you're coming from this article,  <a href="https://www.freecodecamp.org/news/create-a-todo-api-in-deno-written-by-a-guy-coming-from-node/"><strong>Todo API in Deno + Oak (without using a database)</strong></a>, we will do the following:</p>
<ul>
<li>Create a MySQL database connection</li>
<li>Write a small script that resets the database every time we start our Deno server</li>
<li>Perform CRUD operations on a table</li>
<li>Add the CRUD functionality to our API controllers</li>
</ul>
<p>One last thing – here is the entire commit difference that was made in Chapter 1 to add MySQL to the project (<a href="https://github.com/adeelibr/deno-playground/pull/1/commits/5b63b51ebcadededcfec452fe6877a0bd0f1f83f">source code that shows the new additions made from chapter 1</a>).</p>
<p>In your project root folder – mine is called  <em><code>chapter_2:mysql</code>,</em> though  yours can be called whatever you want – create a folder called  <strong>db</strong>. Inside that folder, create a file called  <strong>config.ts and</strong>  add the following content to it:</p>
<pre class="language-autoit"><code class="language-autoit">export <span class="token keyword">const</span> DATABASE<span class="token punctuation">:</span> string <span class="token operator">=</span> <span class="token string">"deno"</span><span class="token comment">;</span>
export <span class="token keyword">const</span> TABLE <span class="token operator">=</span> {
  TODO<span class="token punctuation">:</span> <span class="token string">"todo"</span><span class="token punctuation">,</span>
}<span class="token comment">;</span>

</code></pre>
<p>Nothing fancy here, just defining our database name along with an object for tables and then exporting it. Our project will have one database called &quot;deno&quot; and inside that db we will only have one table called &quot;todo&quot;.</p>
<p>Next, inside the  <strong>db</strong> folder, create another file called  <strong>client.ts</strong> and add the following content:</p>
<pre class="language-autoit"><code class="language-autoit">import { Client } from <span class="token string">"<a class="token url-link" href="https://deno.land/x/mysql/mod.ts">https://deno.land/x/mysql/mod.ts</a>"</span><span class="token comment">;</span>
<span class="token operator">/</span><span class="token operator">/</span> config
import { DATABASE<span class="token punctuation">,</span> TABLE } from <span class="token string">"./config.ts"</span><span class="token comment">;</span>

<span class="token keyword">const</span> client <span class="token operator">=</span> await new <span class="token function">Client</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">;</span>
client<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>{
  hostname<span class="token punctuation">:</span> <span class="token string">"127.0.0.1"</span><span class="token punctuation">,</span>
  username<span class="token punctuation">:</span> <span class="token string">"root"</span><span class="token punctuation">,</span>
  password<span class="token punctuation">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
  db<span class="token punctuation">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
}<span class="token punctuation">)</span><span class="token comment">;</span>

</code></pre>
<p>A couple of things are happening here.</p>
<p>We are importing  <code>Client</code>  from the  <code>mysql</code>  library.  <code>Client</code>  will help us connect to our database and perform operations in the database.</p>
<pre class="language-autoit"><code class="language-autoit">client<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>{
  hostname<span class="token punctuation">:</span> <span class="token string">"127.0.0.1"</span><span class="token punctuation">,</span>
  username<span class="token punctuation">:</span> <span class="token string">"root"</span><span class="token punctuation">,</span>
  password<span class="token punctuation">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
  db<span class="token punctuation">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
}<span class="token punctuation">)</span><span class="token comment">;</span>
</code></pre>
<p><code>Client</code>  provides a method called  <code>connect</code>  which takes in object where we can provide the  <code>hostname</code>,  <code>username</code>,  <code>password</code>, and  <code>db</code>. With this information it can establish a connection to our MySQL instance.</p>
<p>Make sure that your  <code>username</code>  has no  <code>password</code>, as it will conflict with connecting to Deno's MySQL library. If you don't know on how to do that,  <a href="https://github.com/adeelibr/deno-playground/blob/master/guidelines/setting-up-mysql-mac-os-catalina.md#set-your-mysql-password-to-empty">read this tutorial</a>  I wrote.</p>
<p>I have left the  <code>database</code>  field blank here because I want to select it manually later in my script.</p>
<p>Let's add a script that will initialize a database called &quot;deno&quot;, select it, and inside that db create a table called &quot;todo&quot;.</p>
<p>Inside  <code>db/client.ts</code>  file let's make some new additions:</p>
<pre class="language-autoit"><code class="language-autoit">import { Client } from <span class="token string">"<a class="token url-link" href="https://deno.land/x/mysql/mod.ts">https://deno.land/x/mysql/mod.ts</a>"</span><span class="token comment">;</span>
<span class="token operator">/</span><span class="token operator">/</span> config
import { DATABASE<span class="token punctuation">,</span> TABLE } from <span class="token string">"./config.ts"</span><span class="token comment">;</span>
<span class="token keyword">const</span> client <span class="token operator">=</span> await new <span class="token function">Client</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">;</span>
client<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>{
  hostname<span class="token punctuation">:</span> <span class="token string">"127.0.0.1"</span><span class="token punctuation">,</span>
  username<span class="token punctuation">:</span> <span class="token string">"root"</span><span class="token punctuation">,</span>
  password<span class="token punctuation">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
  db<span class="token punctuation">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
}<span class="token punctuation">)</span><span class="token comment">;</span>
<span class="token keyword">const</span> run <span class="token operator">=</span> async <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> {
  <span class="token operator">/</span><span class="token operator">/</span> create database <span class="token punctuation">(</span><span class="token keyword">if</span> <span class="token operator">not</span> created before<span class="token punctuation">)</span>
  await client<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>CREATE DATABASE <span class="token keyword">IF</span> <span class="token operator">NOT</span> EXISTS ${DATABASE}<span class="token punctuation">)</span><span class="token comment">;</span>
  <span class="token operator">/</span><span class="token operator">/</span> <span class="token keyword">select</span> db
  await client<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>USE ${DATABASE}<span class="token punctuation">)</span><span class="token comment">;</span>
  <span class="token operator">/</span><span class="token operator">/</span> delete table <span class="token keyword">if</span> it exists before
  await client<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>DROP TABLE <span class="token keyword">IF</span> EXISTS ${TABLE<span class="token punctuation">.</span>TODO}<span class="token punctuation">)</span><span class="token comment">;</span>
  <span class="token operator">/</span><span class="token operator">/</span> create table
  await client<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>CREATE TABLE ${TABLE<span class="token punctuation">.</span>TODO} <span class="token punctuation">(</span>
        id <span class="token function">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token keyword">NULL</span> AUTO_INCREMENT<span class="token punctuation">,</span>
        todo <span class="token function">varchar</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span>
        isCompleted boolean <span class="token operator">NOT</span> <span class="token keyword">NULL</span> <span class="token keyword">default</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        PRIMARY KEY <span class="token punctuation">(</span>id<span class="token punctuation">)</span>
    <span class="token punctuation">)</span> ENGINE<span class="token operator">=</span>InnoDB <span class="token keyword">DEFAULT</span> CHARSET<span class="token operator">=</span>utf8<span class="token comment">;);</span>
}<span class="token comment">;</span>
<span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">;</span>

</code></pre>
<p>Here we are importing  <code>DATABASE</code>  and  <code>TABLE</code>  from our config file, then using those values in a new function called  <code>run()</code>.</p>
<p>Let's break down this  <code>run()</code>  function. I have added comments in the file to help you understand the workflow:</p>
<pre class="language-autoit"><code class="language-autoit"><span class="token keyword">const</span> run <span class="token operator">=</span> async <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> {
  <span class="token operator">/</span><span class="token operator">/</span> create database <span class="token punctuation">(</span><span class="token keyword">if</span> <span class="token operator">not</span> created before<span class="token punctuation">)</span>
  await client<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>CREATE DATABASE <span class="token keyword">IF</span> <span class="token operator">NOT</span> EXISTS ${DATABASE}<span class="token punctuation">)</span><span class="token comment">;</span>
  <span class="token operator">/</span><span class="token operator">/</span> <span class="token keyword">select</span> db
  await client<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>USE ${DATABASE}<span class="token punctuation">)</span><span class="token comment">;</span>
  <span class="token operator">/</span><span class="token operator">/</span> delete table <span class="token keyword">if</span> it exists before
  await client<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>DROP TABLE <span class="token keyword">IF</span> EXISTS ${TABLE<span class="token punctuation">.</span>TODO}<span class="token punctuation">)</span><span class="token comment">;</span>
  <span class="token operator">/</span><span class="token operator">/</span> create table
  await client<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>CREATE TABLE ${TABLE<span class="token punctuation">.</span>TODO} <span class="token punctuation">(</span>
        id <span class="token function">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token keyword">NULL</span> AUTO_INCREMENT<span class="token punctuation">,</span>
        todo <span class="token function">varchar</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span>
        isCompleted boolean <span class="token operator">NOT</span> <span class="token keyword">NULL</span> <span class="token keyword">default</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        PRIMARY KEY <span class="token punctuation">(</span>id<span class="token punctuation">)</span>
    <span class="token punctuation">)</span> ENGINE<span class="token operator">=</span>InnoDB <span class="token keyword">DEFAULT</span> CHARSET<span class="token operator">=</span>utf8<span class="token comment">;);</span>
}<span class="token comment">;</span>

</code></pre>
<ul>
<li>Create a database called  <code>deno</code>  . If it already exists then do nothing.</li>
<li>Then select the database to use, which is called  <code>deno</code></li>
<li>Delete the table inside  <code>deno</code>  called  <code>todo</code>  if it already exists.</li>
<li>Next, create a new table inside the  <code>deno</code>  db, call it  <code>todo</code>, and define its structure: It will have a unique auto increment  <code>id</code>  which will be an integer, another field called  <code>todo</code>  which will be a string, and finally a field called  <code>isCompleted</code>  which is a boolean. I also define  <code>id</code>  as my primary key.</li>
</ul>
<p>The reason I wrote this script was because I don't want to have extra information in MySQL instance. Every time the script runs it just reinitializes everything.</p>
<p>You don't have to add this script. But if you don't, then you will have to manually create a db and the table.</p>
<p>Also, check out the Deno MySQL library's docs on  <a href="https://deno.land/x/mysql/#create-database">db creation</a>  and on  <a href="https://deno.land/x/mysql/#create-table">table creation</a>.</p>
<p>Going back to our agenda, we just achieved two things out of the four mentioned at the top of the article:</p>
<ul>
<li>Create a MySQL database connection</li>
<li>Write a small script that resets the database every time we start our Deno server</li>
</ul>
<p>That is already 50% of the tutorial. Unfortunately, we can't see much happening right now. Let's quickly add some functionality to see it working.</p>
<h2 id="performing-crud-operations-on-a-table-and-adding-the-functionality-to-our-api-controllers">Performing CRUD operations on a table and adding the functionality to our API controllers<a class="anchor" href="#performing-crud-operations-on-a-table-and-adding-the-functionality-to-our-api-controllers">§</a></h2>
<p>We need to update our Todo interface first. Go to the  <code>interfaces/Todo.ts</code>  file and add the following:</p>
<pre class="language-autoit"><code class="language-autoit">export <span class="token keyword">default</span> interface Todo {
  id<span class="token operator">?</span><span class="token punctuation">:</span> number<span class="token punctuation">,</span>
  todo<span class="token operator">?</span><span class="token punctuation">:</span> string<span class="token punctuation">,</span>
  isCompleted<span class="token operator">?</span><span class="token punctuation">:</span> boolean<span class="token punctuation">,</span>
}

</code></pre>
<p>What this  <code>?</code>  does is it makes the key in the object optional. I did this because later I will use different functions to pass objects with only an  <code>id</code>,  <code>todo</code>,  <code>isCompleted</code>, or all of them at once.</p>
<p>If you want to learn more about optional properties in TypeScript, head over to their docs  <a href="https://www.typescriptlang.org/docs/handbook/interfaces.html#optional-properties">here</a>.</p>
<p>Next, create a new folder called  <strong>models</strong> and inside that folder, create a file called  <strong>todo.ts</strong>.  Add the following content to the file:</p>
<pre class="language-autoit"><code class="language-autoit">import client from <span class="token string">"../db/client.ts"</span><span class="token comment">;</span>
<span class="token operator">/</span><span class="token operator">/</span> config
import { TABLE } from <span class="token string">"../db/config.ts"</span><span class="token comment">;</span>
<span class="token operator">/</span><span class="token operator">/</span> Interface
import Todo from <span class="token string">"../interfaces/Todo.ts"</span><span class="token comment">;</span>
export <span class="token keyword">default</span> {
  <span class="token operator">/</span><span class="token operator">*</span><span class="token operator">*</span>

</code></pre>
<p>Right now the functions are empty, but that is okay. We will fill them up one by one.</p>
<p>Next go to  <code>controllers/todo.ts</code>  file and make sure you add the following:</p>
<pre class="language-autoit"><code class="language-autoit"><span class="token operator">/</span><span class="token operator">/</span> interfaces
import Todo from <span class="token string">"../interfaces/Todo.ts"</span><span class="token comment">;</span>
<span class="token operator">/</span><span class="token operator">/</span> models
import TodoModel from <span class="token string">"../models/todo.ts"</span><span class="token comment">;</span>

export <span class="token keyword">default</span> {
  <span class="token operator">/</span><span class="token operator">*</span><span class="token operator">*</span>

</code></pre>
<p>Here we have empty functions as well. Let's start filling them up.</p>
<h3 id="get-all-todos-api">[Get] all todos API<a class="anchor" href="#get-all-todos-api">§</a></h3>
<p>Inside  <code>models/todo.ts</code>, add a definition for a function called  <code>getAll</code>:</p>
<pre class="language-autoit"><code class="language-autoit">import client from <span class="token string">"../db/client.ts"</span><span class="token comment">;</span>
<span class="token operator">/</span><span class="token operator">/</span> config
import { TABLE } from <span class="token string">"../db/config.ts"</span><span class="token comment">;</span>
<span class="token operator">/</span><span class="token operator">/</span> Interface
import Todo from <span class="token string">"../interfaces/Todo.ts"</span><span class="token comment">;</span>

export <span class="token keyword">default</span> {
   <span class="token operator">/</span><span class="token operator">*</span><span class="token operator">*</span>

</code></pre>
<p>We simply run a MySQL query to get all entries from table.</p>
<p>The  <code>Client</code>  also exposes another method besides  <code>connect</code>  (we used a &quot;connect&quot; method in  <code>db/client.ts</code>  file) and that is  <code>query</code>. The  <code>client.query</code>  method lets us run MySQL queries directly from our Deno code as is.</p>
<p>Next go to  <code>controllers/todo.ts</code>  add definition for  <code>getAllTodos</code>:</p>
<pre class="language-autoit"><code class="language-autoit"><span class="token operator">/</span><span class="token operator">/</span> interfaces
import Todo from <span class="token string">"../interfaces/Todo.ts"</span><span class="token comment">;</span>
<span class="token operator">/</span><span class="token operator">/</span> models
import TodoModel from <span class="token string">"../models/todo.ts"</span><span class="token comment">;</span>

export <span class="token keyword">default</span> {
  <span class="token operator">/</span><span class="token operator">*</span><span class="token operator">*</span>

</code></pre>
<p>All we are doing is importing  <code>TodoModel</code>  and using its method called  <code>getAll</code>, which we just defined now. Since it returns as a promise we have wrapped it in async/await.</p>
<p>The method  <code>TodoModel.getAll()</code>  will return us an array which we simply return to  <code>response.body</code>  with  <code>status</code>  set to  <code>200</code>.</p>
<p>If the promise fails or there is another error, we simply go to our catch block and return a status of 400 with  <code>success</code>  set to false. We also set the  <code>message</code>  to what we get from the catch block.</p>
<p>That's it, we're done. Now let's fire up our terminal.</p>
<p>Make sure your MySQL instance is running. In your terminal type:</p>
<pre class="language-autoit"><code class="language-autoit">$ deno run <span class="token operator">-</span><span class="token operator">-</span>allow<span class="token operator">-</span>net server<span class="token punctuation">.</span>ts 
</code></pre>
<p>Your terminal should look something like this:</p>
<p><img src="https://www.freecodecamp.org/news/content/images/2020/06/Screenshot-2020-06-04-at-23.29.19.png" alt=""></p>
<p>This is how my console looks when I start the server</p>
<p>My console is telling me two things here.</p>
<ol>
<li>That my Deno API server is running on port 8080</li>
<li>That my MySQL instance is running on  <code>127.0.0.1</code>, which is  <code>localhost</code></li>
</ol>
<p>Let's test our API out. I am using  <a href="https://www.postman.com/">Postman</a>  here, but you can use your favorite API client.</p>
<p><img src="https://www.freecodecamp.org/news/content/images/2020/06/Screenshot-2020-06-04-at-23.31.07.png" alt=""></p>
<p>running [GET] localhost:8080/todos =&gt; Will return all todos</p>
<p>Right now it only returns empty data. But once we add data to our  <code>todo</code>  table, it will return those todos here.</p>
<p>Awesome. One API down and four more to go.</p>
<h3 id="post-add-a-todo-api">[Post] add a todo API<a class="anchor" href="#post-add-a-todo-api">§</a></h3>
<p>In the  <code>models/todo.ts</code>  file, add the following definition for  <code>add()</code>  function:</p>
<pre class="language-autoit"><code class="language-autoit">export <span class="token keyword">default</span> {
<span class="token operator">/</span><span class="token operator">*</span><span class="token operator">*</span>

Adds a new todo item <span class="token keyword">to</span> todo table

<span class="token variable">@param</span> todo

<span class="token variable">@param</span> isCompleted


</code></pre>
<p>The add function takes in object as an argument, which has two items:  <code>todo</code>  and  <code>isCompleted</code>.</p>
<p>So  <code>_add_:  _async_  ({ todo, isCompleted }: Todo) =&gt; {}</code>  can also be written as  <code>({todo, isCompleted}: {todo:string, isCompleted:boolean})</code>. But since we already have an interface defined in our  <code>interfaces/Todo.ts</code>  file which is</p>
<pre class="language-autoit"><code class="language-autoit">export <span class="token keyword">default</span> interface Todo {
id<span class="token operator">?</span><span class="token punctuation">:</span> number<span class="token punctuation">,</span>
todo<span class="token operator">?</span><span class="token punctuation">:</span> string<span class="token punctuation">,</span>
isCompleted<span class="token operator">?</span><span class="token punctuation">:</span> boolean<span class="token punctuation">,</span>
}

</code></pre>
<p>we can simply write this as  <code>_add_:  _async_  ({ todo, isCompleted }: Todo) =&gt; {}</code>. This tells TypeScript that this function has two arguments,  <code>todo</code>, which is a string, and  <code>isCompleted</code>, which is a boolean.</p>
<p>If you want to read more on interfaces, TypeScript has an excellent document on it which you can find  <a href="https://www.typescriptlang.org/docs/handbook/interfaces.html">here</a>.</p>
<p>Inside our function we have the following:</p>
<pre class="language-autoit"><code class="language-autoit">return await client<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>
INSERT INTO ${TABLE<span class="token punctuation">.</span>TODO}<span class="token punctuation">(</span>todo<span class="token punctuation">,</span> isCompleted<span class="token punctuation">)</span> <span class="token function">values</span><span class="token punctuation">(</span><span class="token operator">?</span><span class="token punctuation">,</span> <span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">[</span>
todo<span class="token punctuation">,</span>
isCompleted<span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token comment">;</span>
</code></pre>
<p>This query can be broken down into two parts:</p>
<ul>
<li><code>INSERT INTO ${TABLE_._TODO}(todo, isCompleted) values(?, ?)</code>. The two question marks here denote a use of variables inside this query.</li>
<li>The other part,  <code>[todo, isCompleted]</code>, is the variables that will go in the  <em>first part</em> of the query and be replaced with  <code>(?, ?)</code></li>
<li><code>Table.Todo</code>  is just a string coming from file  <code>db/config.ts</code>  where the  <code>Table.Todo</code>  value is &quot;<code>todo</code>&quot;</li>
</ul>
<p>Next inside our  <code>controllers/todo.ts</code>  file, go to the definition of the  <code>createTodo()</code>  function:</p>
<pre class="language-autoit"><code class="language-autoit">export <span class="token keyword">default</span> {
<span class="token operator">/</span><span class="token operator">*</span><span class="token operator">*</span>

<span class="token variable">@description</span> Add a new todo

<span class="token variable">@route</span> POST <span class="token operator">/</span>todos


</code></pre>
<p>Let's break this down into two parts:</p>
<p><strong>Part 1</strong></p>
<pre class="language-autoit"><code class="language-autoit"><span class="token keyword">const</span> body <span class="token operator">=</span> await request<span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>!request<span class="token punctuation">.</span>hasBody<span class="token punctuation">)</span> {
response<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token number">400</span><span class="token comment">;</span>
response<span class="token punctuation">.</span>body <span class="token operator">=</span> {
success<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
message<span class="token punctuation">:</span> <span class="token string">"No data provided"</span><span class="token punctuation">,</span>
}<span class="token comment">;</span>
return<span class="token comment">;</span>
}
</code></pre>
<p>All we are doing here is checking if the user is sending data in body. If not, then we return a status  <code>400</code>  and in the body return  <code>success: false</code>  and  <code>message: &lt;erromessage-string&gt;</code>.</p>
<p><strong>Part 2</strong></p>
<pre class="language-autoit"><code class="language-autoit">try {
await TodoModel<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>
{ todo<span class="token punctuation">:</span> body<span class="token punctuation">.</span>value<span class="token punctuation">.</span>todo<span class="token punctuation">,</span> isCompleted<span class="token punctuation">:</span> <span class="token boolean">false</span> }<span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token comment">;</span>
response<span class="token punctuation">.</span>body <span class="token operator">=</span> {
success<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
message<span class="token punctuation">:</span> <span class="token string">"The record was added successfully"</span><span class="token punctuation">,</span>
}<span class="token comment">;</span>
} catch <span class="token punctuation">(</span>error<span class="token punctuation">)</span> {
response<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token number">400</span><span class="token comment">;</span>
response<span class="token punctuation">.</span>body <span class="token operator">=</span> {
success<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
message<span class="token punctuation">:</span> Error<span class="token punctuation">:</span> ${error}<span class="token punctuation">,</span>
}<span class="token comment">;</span>
}
</code></pre>
<p>If there is no error, the  <code>TodoModel.add()</code>  function is called and simply returns a status of  <code>200</code>  and a confirmation message to the user.</p>
<p>Otherwise it just throws a similar error that we did in the previous API.</p>
<p>Now we're done. Fire up your terminal and make sure your MySQL instance is running. In your terminal type:</p>
<pre class="language-autoit"><code class="language-autoit">$ deno run <span class="token operator">-</span><span class="token operator">-</span>allow<span class="token operator">-</span>net server<span class="token punctuation">.</span>ts 
</code></pre>
<p>Go to  <a href="https://www.postman.com/">Postman</a>  and run the API route for this controller:</p>
<p><img src="https://www.freecodecamp.org/news/content/images/2020/06/Screenshot-2020-06-04-at-23.55.02.png" alt=""></p>
<p>running [POST] localhost:8080/todos =&gt; Will add a new new todo item</p>
<p><img src="https://www.freecodecamp.org/news/content/images/2020/06/Screenshot-2020-06-04-at-23.57.06.png" alt=""></p>
<p>running [POST] localhost:8080/todos =&gt; Will return all todos, notice how the new added item is being returned as well</p>
<p>This is great, now we have two working APIs. Only three more to go.</p>
<h3 id="get-todo-by-id-api">[GET] todo by id API<a class="anchor" href="#get-todo-by-id-api">§</a></h3>
<p>In your  <code>models/todo.ts</code>  file, add definition for these two functions,  <code>doesExistById()</code>  and  <code>getById()</code>:</p>
<pre class="language-autoit"><code class="language-autoit">export <span class="token keyword">default</span> {
<span class="token operator">/</span><span class="token operator">*</span><span class="token operator">*</span>

Takes <span class="token keyword">in</span> the id params <span class="token operator">&amp;</span> checks <span class="token keyword">if</span> the todo item exists

<span class="token keyword">in</span> the database

<span class="token variable">@param</span> id

<span class="token variable">@returns</span> boolean <span class="token keyword">to</span> tell <span class="token keyword">if</span> an entry of todo exits <span class="token keyword">in</span> table

<span class="token operator">/</span>
doesExistById<span class="token punctuation">:</span> async <span class="token punctuation">(</span>{ id }<span class="token punctuation">:</span> Todo<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> {
<span class="token keyword">const</span> <span class="token punctuation">[</span>result<span class="token punctuation">]</span> <span class="token operator">=</span> await client<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>
  <span class="token keyword">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> count FROM ${TABLE<span class="token punctuation">.</span>TODO} WHERE id <span class="token operator">=</span> <span class="token operator">?</span> LIMIT <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token comment">;</span>
return result<span class="token punctuation">.</span>count <span class="token operator">></span> <span class="token number">0</span><span class="token comment">;</span>
}<span class="token punctuation">,</span>
<span class="token operator">/</span><span class="token operator">*</span><span class="token operator">*</span>

Takes <span class="token keyword">in</span> the id params <span class="token operator">&amp;</span> returns the todo item found

against it<span class="token punctuation">.</span>

<span class="token variable">@param</span> id

<span class="token variable">@returns</span> object of todo item


</code></pre>
<p>Let's talk about each function one by one:</p>
<ul>
<li><code>doesExistById</code>  takes in an  <code>id</code>  and returns a  <code>boolean</code>  indicating whether a particular todo exists in the database or not.</li>
</ul>
<p>Let's break this function down:</p>
<pre class="language-autoit"><code class="language-autoit"><span class="token keyword">const</span> <span class="token punctuation">[</span>result<span class="token punctuation">]</span> <span class="token operator">=</span> await client<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>
<span class="token keyword">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> count FROM ${TABLE<span class="token punctuation">.</span>TODO} WHERE id <span class="token operator">=</span> <span class="token operator">?</span> LIMIT <span class="token number">1</span><span class="token punctuation">,</span>
<span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token comment">;</span>
return result<span class="token punctuation">.</span>count <span class="token operator">></span> <span class="token number">0</span><span class="token comment">;</span>
</code></pre>
<p>We simply check the count here in the table against a particular todo id. If the count is greater than zero, we return  <code>true</code>. Otherwise, we return  <code>false</code>.</p>
<ul>
<li><code>getById</code>  returns the todo item against a particular id:</li>
</ul>
<pre class="language-autoit"><code class="language-autoit">return await client<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> FROM ${TABLE<span class="token punctuation">.</span>TODO} WHERE id <span class="token operator">=</span> <span class="token operator">?</span><span class="token punctuation">,</span>
<span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token comment">;</span>
</code></pre>
<p>We are simply running a MySQL query here to get a todo by id and returning the result as-is.</p>
<p>Next, go to your  <code>controllers/todo.ts</code>  file and add a definition for a  <code>getTodoById</code>  controller method:</p>
<pre class="language-autoit"><code class="language-autoit">export <span class="token keyword">default</span> {
<span class="token operator">/</span><span class="token operator">*</span><span class="token operator">*</span>

<span class="token variable">@description</span> Get todo by id

<span class="token variable">@route</span> GET todos<span class="token operator">/</span><span class="token punctuation">:</span>id


</code></pre>
<p>Let's break this down into two smaller parts:</p>
<pre class="language-autoit"><code class="language-autoit"><span class="token keyword">const</span> isAvailable <span class="token operator">=</span> await TodoModel<span class="token punctuation">.</span><span class="token function">doesExistById</span><span class="token punctuation">(</span>
{ id<span class="token punctuation">:</span> <span class="token function">Number</span><span class="token punctuation">(</span>params<span class="token punctuation">.</span>id<span class="token punctuation">)</span> }<span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token comment">;</span>



</code></pre>
<p>First we check if the todo exists in the database against an id by using this method:</p>
<pre class="language-autoit"><code class="language-autoit"><span class="token keyword">const</span> isAvailable <span class="token operator">=</span> await TodoModel<span class="token punctuation">.</span><span class="token function">doesExistById</span><span class="token punctuation">(</span>
  { id<span class="token punctuation">:</span> <span class="token function">Number</span><span class="token punctuation">(</span>params<span class="token punctuation">.</span>id<span class="token punctuation">)</span> }<span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token comment">;</span>
</code></pre>
<p>Here we need to convert  <code>params.id</code>  into a  <code>Number</code>  because our todo interface only accepts  <code>id</code>  as a number. Next, we just pass  <code>params.id</code>  to the  <code>doesExistById</code>  method. This method will return as a boolean.</p>
<p>Then we simply check if the todo is not available and return a  <code>404</code>  method with our standard response like with the previous endpoints:</p>
<pre class="language-autoit"><code class="language-autoit"><span class="token keyword">if</span> <span class="token punctuation">(</span>!isAvailable<span class="token punctuation">)</span> {
  response<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token number">404</span><span class="token comment">;</span>
  response<span class="token punctuation">.</span>body <span class="token operator">=</span> {
    success<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    message<span class="token punctuation">:</span> <span class="token string">"No todo found"</span><span class="token punctuation">,</span>
  }<span class="token comment">;</span>
  return<span class="token comment">;</span>
}
</code></pre>
<p>Then we have:</p>
<pre class="language-autoit"><code class="language-autoit">try {
<span class="token keyword">const</span> todo<span class="token punctuation">:</span> Todo <span class="token operator">=</span> await TodoModel<span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span>{ id<span class="token punctuation">:</span> <span class="token function">Number</span><span class="token punctuation">(</span>params<span class="token punctuation">.</span>id<span class="token punctuation">)</span> }<span class="token punctuation">)</span><span class="token comment">;</span>
response<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token number">200</span><span class="token comment">;</span>
response<span class="token punctuation">.</span>body <span class="token operator">=</span> {
  success<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  data<span class="token punctuation">:</span> todo<span class="token punctuation">,</span>
}<span class="token comment">;</span>
} catch <span class="token punctuation">(</span>error<span class="token punctuation">)</span> {
response<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token number">400</span><span class="token comment">;</span>
response<span class="token punctuation">.</span>body <span class="token operator">=</span> {
  success<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  message<span class="token punctuation">:</span> Error<span class="token punctuation">:</span> ${error}<span class="token punctuation">,</span>
}<span class="token comment">;</span>
</code></pre>
<p>This is similar to what we were doing in our previous APIs. Here we are simply getting data from the db, setting the variable  <code>todo</code>, and then returning the response. If there is an error we simply return a standard error message in the catch block back to the user.</p>
<p>Now fire up your terminal and make sure your MySQL instance is running. In your terminal type:</p>
<pre class="language-autoit"><code class="language-autoit">$ deno run <span class="token operator">-</span><span class="token operator">-</span>allow<span class="token operator">-</span>net server<span class="token punctuation">.</span>ts 
</code></pre>
<p>Go to  <a href="https://www.postman.com/">Postman</a>  and run the API route for this controller.</p>
<p>Remember that every time we restart our server we reset the db. If you don't want this behavior, you can simply comment out the  <code>run</code>  function in the file  <code>db/client.ts</code>.</p>
<p><img src="https://www.freecodecamp.org/news/content/images/2020/06/Screenshot-2020-06-07-at-17.09.32.png" alt=""></p>
<p>running [POST] localhost:8080/todos =&gt; Will add a new new todo item</p>
<p><img src="https://www.freecodecamp.org/news/content/images/2020/06/Screenshot-2020-06-07-at-17.10.13.png" alt=""></p>
<p>running [POST] localhost:8080/todos =&gt; Will return all todos</p>
<p><img src="https://www.freecodecamp.org/news/content/images/2020/06/Screenshot-2020-06-07-at-17.11.03.png" alt=""></p>
<p>running [GET] localhost:8080/todos/:id =&gt; will return the todo for that id if found</p>
<p><img src="https://www.freecodecamp.org/news/content/images/2020/06/Screenshot-2020-06-07-at-17.16.06.png" alt="running [GET] localhost:8080/todos/:id =&gt; will return the todo for that id if found"></p>
<p>running [GET] localhost:8080/todos/<unknown-id> =&gt; returns status 404 with not found error message</p>
<p>So far we have done APIs for:</p>
<ul>
<li>Get all todos</li>
<li>Create a new todo</li>
<li>Get a todo by ID</li>
</ul>
<p>And here are the remaining APIs:</p>
<ul>
<li>Update a todo by ID</li>
<li>Delete a todo by ID</li>
</ul>
<h3 id="put-update-todo-by-id-api">[PUT] update todo by id API<a class="anchor" href="#put-update-todo-by-id-api">§</a></h3>
<p>Let's create a model for this API first. Go in our  <code>models/todo.ts</code>  file and add a definition for an  <code>updateById</code>  function:</p>
<pre class="language-autoit"><code class="language-autoit"><span class="token operator">*</span><span class="token operator">*</span>

</code></pre>
<p>The  <code>updateById</code>  takes in 3 params:  <code>id</code>,  <code>todo</code>, and  <code>isCompleted</code>.</p>
<p>We simply run a MySQL query inside this function:</p>
<pre class="language-autoit"><code class="language-autoit">onst result <span class="token operator">=</span> await client<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>
UPDATE ${TABLE<span class="token punctuation">.</span>TODO} SET todo<span class="token operator">=</span><span class="token operator">?</span><span class="token punctuation">,</span> isCompleted<span class="token operator">=</span><span class="token operator">?</span> WHERE id<span class="token operator">=</span><span class="token operator">?</span><span class="token punctuation">,</span>
<span class="token punctuation">[</span>
  todo<span class="token punctuation">,</span>
  isCompleted<span class="token punctuation">,</span>
  id<span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token comment">;</span>
</code></pre>
<p>This updates a single todo item's  <code>todo</code>  and  <code>isCompleted</code>  by a specific  <code>id</code>.</p>
<p>Next we return a count of rows updated by this query by doing:</p>
<pre class="language-autoit"><code class="language-autoit">  <span class="token operator">/</span><span class="token operator">/</span> return count of rows updated
return result<span class="token punctuation">.</span>affectedRows<span class="token comment">;</span>
</code></pre>
<p>The count will either be 0 or 1, but never more than 1. This is because we have unique IDs in our database – multiple todos with the same ID cannot exist.</p>
<p>Next go to our  <code>controllers/todo.ts</code>  file and add a definition for a  <code>updateTodoById</code>  function:</p>
<pre class="language-autoit"><code class="language-autoit">updateTodoById<span class="token punctuation">:</span> async <span class="token punctuation">(</span>
{ params<span class="token punctuation">,</span> request<span class="token punctuation">,</span> response }<span class="token punctuation">:</span> {
  params<span class="token punctuation">:</span> { id<span class="token punctuation">:</span> string }<span class="token comment">;</span>
  request<span class="token punctuation">:</span> any<span class="token comment">;</span>
  response<span class="token punctuation">:</span> any<span class="token comment">;</span>
}<span class="token punctuation">,</span>
<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> {
try {
  <span class="token keyword">const</span> isAvailable <span class="token operator">=</span> await TodoModel<span class="token punctuation">.</span><span class="token function">doesExistById</span><span class="token punctuation">(</span>
{ id<span class="token punctuation">:</span> <span class="token function">Number</span><span class="token punctuation">(</span>params<span class="token punctuation">.</span>id<span class="token punctuation">)</span> }<span class="token punctuation">,</span>  <span class="token punctuation">)</span><span class="token comment">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>!isAvailable<span class="token punctuation">)</span> {
response<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token number">404</span><span class="token comment">;</span>
response<span class="token punctuation">.</span>body <span class="token operator">=</span> {
  success<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  message<span class="token punctuation">:</span> <span class="token string">"No todo found"</span><span class="token punctuation">,</span>
}<span class="token comment">;</span>
return<span class="token comment">;  }</span>
  <span class="token operator">/</span><span class="token operator">/</span> <span class="token keyword">if</span> todo found <span class="token keyword">then</span> update todo
  <span class="token keyword">const</span> body <span class="token operator">=</span> await request<span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">;</span>
  <span class="token keyword">const</span> updatedRows <span class="token operator">=</span> await TodoModel<span class="token punctuation">.</span><span class="token function">updateById</span><span class="token punctuation">(</span>{
id<span class="token punctuation">:</span> <span class="token function">Number</span><span class="token punctuation">(</span>params<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>body<span class="token punctuation">.</span>value<span class="token punctuation">,</span>  }<span class="token punctuation">)</span><span class="token comment">;</span>
  response<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token number">200</span><span class="token comment">;</span>
  response<span class="token punctuation">.</span>body <span class="token operator">=</span> {
success<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
message<span class="token punctuation">:</span> `Successfully updated ${updatedRows} <span class="token function">row</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>`<span class="token punctuation">,</span>  }<span class="token comment">;</span>
} catch <span class="token punctuation">(</span>error<span class="token punctuation">)</span> {
  response<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token number">400</span><span class="token comment">;</span>
  response<span class="token punctuation">.</span>body <span class="token operator">=</span> {
success<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
message<span class="token punctuation">:</span> `Error<span class="token punctuation">:</span> ${error}`<span class="token punctuation">,</span>
</code></pre>
<p>This is almost the same as of our previous APIs we wrote. The part that's new here is this:</p>
<pre class="language-autoit"><code class="language-autoit"><span class="token operator">/</span><span class="token operator">/</span> <span class="token keyword">if</span> todo found <span class="token keyword">then</span> update todo
<span class="token keyword">const</span> body <span class="token operator">=</span> await request<span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">;</span>
<span class="token keyword">const</span> updatedRows <span class="token operator">=</span> await TodoModel<span class="token punctuation">.</span><span class="token function">updateById</span><span class="token punctuation">(</span>{
id<span class="token punctuation">:</span> <span class="token function">Number</span><span class="token punctuation">(</span>params<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>body<span class="token punctuation">.</span>value<span class="token punctuation">,</span>
}<span class="token punctuation">)</span><span class="token comment">;</span>
</code></pre>
<p>We simple get the body that the user sends us in JSON and pass the body to our  <code>TodoModel.updateById</code>  function.</p>
<p>We have to convert the  <code>id</code>  to a number to comply with our Todo interface.</p>
<p>The query is executed and returns the count of updated rows. From there we simply return it in our response. If there is an error it goes to the catch block where we return our standard response message.</p>
<p>Let's run this and see if it works. Make sure your MySQL instance is running and run the following from your terminal:</p>
<pre class="language-autoit"><code class="language-autoit">$ deno run <span class="token operator">-</span><span class="token operator">-</span>allow<span class="token operator">-</span>net server<span class="token punctuation">.</span>ts 
</code></pre>
<p>Go to  <a href="https://www.postman.com/">Postman</a>  and run the API route for this controller:</p>
<p><img src="https://www.freecodecamp.org/news/content/images/2020/06/Screenshot-2020-06-07-at-17.42.02.png" alt=""></p>
<p>running [PUT] localhost:8080/todos/:id =&gt; will update content of that todo by given id</p>
<p><img src="https://www.freecodecamp.org/news/content/images/2020/06/Screenshot-2020-06-07-at-17.43.13.png" alt=""></p>
<p>running [GET] localhost:8080/todos/ =&gt; will return all todos, see how the todo you updated is also showing there.</p>
<h3 id="delete-todo-by-id-api">[DELETE] todo by id API<a class="anchor" href="#delete-todo-by-id-api">§</a></h3>
<p>In your  <code>models/todo.ts</code>  file create a function called  <code>deleteById</code>:</p>
<pre class="language-autoit"><code class="language-autoit"><span class="token operator">/</span><span class="token operator">*</span><span class="token operator">*</span>

Deletes a todo by ID

<span class="token variable">@param</span> id

<span class="token variable">@returns</span> integer <span class="token punctuation">(</span>count of effect rows<span class="token punctuation">)</span>


</code></pre>
<p>Here we simply pass an  <code>id</code>  as a param and then use the delete MySQL query. We then return the updated count of rows. The updated count will either be 0 or 1 because the ID of each todo is unique.</p>
<p>Next, go in your  <code>controllers/todo.ts</code>  file and define a  <code>deleteByTodoId</code>  method:</p>
<pre class="language-autoit"><code class="language-autoit"><span class="token operator">/</span><span class="token operator">*</span><span class="token operator">*</span>

<span class="token variable">@description</span> Delete todo by id

<span class="token variable">@route</span> DELETE todos<span class="token operator">/</span><span class="token punctuation">:</span>id


</code></pre>
<p>This is pretty straightforward. We pass the  <code>params.id</code>  to our  <code>TodoModel.deleteById</code>  method and return the count of rows updated with this query.</p>
<p>If anything goes wrong an error is thrown in the catch block which returns our standard error response.</p>
<p>Let's check this out.</p>
<p>Make sure your MySQL instance is running. In your terminal type:</p>
<pre class="language-autoit"><code class="language-autoit">$ deno run <span class="token operator">-</span><span class="token operator">-</span>allow<span class="token operator">-</span>net server<span class="token punctuation">.</span>ts 
</code></pre>
<p>Go to  <a href="https://www.postman.com/">Postman</a>  and run the API route for this controller:</p>
<p><img src="https://www.freecodecamp.org/news/content/images/2020/06/Screenshot-2020-06-07-at-18.23.04.png" alt=""></p>
<p>running [GET] localhost:8080/todos/ =&gt; will return all todos</p>
<p><img src="https://www.freecodecamp.org/news/content/images/2020/06/Screenshot-2020-06-07-at-18.23.11.png" alt=""></p>
<p>running [DELETE] localhost:8080/todos/:id =&gt; will delete a todo by ID</p>
<p><img src="https://www.freecodecamp.org/news/content/images/2020/06/Screenshot-2020-06-07-at-18.23.44.png" alt=""></p>
<p>running [GET] localhost:8080/todos/ =&gt; will return all todos, see how todo with &quot;id&quot; is no longer here</p>
<p>With this we are done with our Deno + Oak + MySQL tutorial.</p>
<p>The entire source code is available here:  <a href="https://github.com/adeelibr/deno-playground">https://github.com/adeelibr/deno-playground</a>. If you find an issue, just let me know. Or feel free to make a pull request and I'll give you credit in the repository.</p>
<p>If you found this tutorial helpful, please share it. And as always, I am available on  <a href="https://twitter.com/adeelibr">Twitter under @adeelibr</a>. I would love to hear your thoughts on it.</p></article><div id="gitalk-container"></div><link id="gitalk-css" rel="preload" href="https://cdn.pagic.org/gitalk@1.6.2/dist/gitalk.css" as="style"/><script defer="" src="https://cdn.pagic.org/gitalk@1.6.2/dist/gitalk.min.js"></script></div><div class="main_toc_container nav_link_container"><div class="main_toc"><aside><nav class="toc"><ol><li><a href="#lets-begin">Let&#39;s Begin</a></li><li><a href="#performing-crud-operations-on-a-table-and-adding-the-functionality-to-our-api-controllers">Performing CRUD operations on a table and adding the functionality to our API controllers</a><ol><li><a href="#get-all-todos-api">[Get] all todos API</a></li><li><a href="#post-add-a-todo-api">[Post] add a todo API</a></li><li><a href="#get-todo-by-id-api">[GET] todo by id API</a></li><li><a href="#put-update-todo-by-id-api">[PUT] update todo by id API</a></li><li><a href="#delete-todo-by-id-api">[DELETE] todo by id API</a></li></ol></li></ol></nav></aside></div></div></section><footer>Powered by <a href="https://github.com/xcatliu/pagic" target="_blank">Pagic</a></footer><div class="tools flex_center hide_on_mobile"><a class="czs-angle-up-l button" href="#" style="background-image:url(&quot;/assets/czs-angle-up-l.svg&quot;)"></a></div><script src="https://cdn.pagic.org/react@16.13.1/umd/react.production.min.js"></script><script src="https://cdn.pagic.org/react-dom@16.13.1/umd/react-dom.production.min.js"></script><script type="module" src="/index.js"></script></body></html>